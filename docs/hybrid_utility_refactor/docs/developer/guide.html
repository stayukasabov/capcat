<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Developer Guide</title>
    <link rel="stylesheet" href="../../css/design-system.css">
    <link rel="stylesheet" href="../../css/main.css">
</head>
<body>
    <!-- Header -->
    {% include header.html %}


    <div class="doc-container">
        <div class="container">
            <div class="doc-content">

<div class="nav-breadcrumb"><a href="../index.html">Documentation Home</a> / developer</div>
<h1>Developer Guide</h1>

<h2>Getting Started</h2>

<h3>Prerequisites</h3>

<ul>
<li>Python 3.8+</li>
<li>pip (Python package manager)</li>
<li>git</li>
</ul>

<h3>Setup Development Environment</h3>

<pre><code># Clone the repository
git clone &lt;repository-url&gt;
cd capcat

# Create virtual environment
python3 -m venv venv
source venv/bin/activate  # On Windows: venv\Scripts\activate

# Install dependencies
pip install -r requirements.txt

# Install development dependencies
pip install -r requirements-dev.txt

# Verify installation
./capcat list sources
</code></pre>

<h2>Project Structure</h2>

<div class="ascii-art">Application/
├── capcat.py              # Main application entry point
├── capcat                 # Bash wrapper script
├── run_capcat.py          # Python wrapper
├── cli.py                 # Command-line interface
├── core/                  # Core functionality
│   ├── source_system/     # Source management framework
│   ├── config.py          # Configuration management
│   ├── article_fetcher.py # Article processing
│   └── unified_media_processor.py  # Media handling
├── sources/               # News source implementations
│   ├── active/           # Active sources
│   │   ├── config_driven/ # YAML-configured sources
│   │   └── custom/        # Python-implemented sources
│   └── base/             # Base classes and schemas
├── htmlgen/              # HTML generation system
├── themes/               # CSS themes for HTML output
└── docs/                 # Documentation
</div>

<h2>Development Workflow</h2>

<h3>Adding a New Source</h3>

<h3>Option 1: Config-Driven Source (Simple)</h3>

<ol>
<li>Create YAML configuration:</li>
</ol>

<pre><code># sources/active/config_driven/configs/newsource.yaml
display_name: &quot;New Source&quot;
base_url: &quot;https://newsource.com/&quot;
category: tech
article_selectors: [&quot;.headline a&quot;]
content_selectors: [&quot;.article-content&quot;]
</code></pre>

<ol>
<li>Verify the source:</li>
</ol>

<pre><code>./capcat fetch newsource --count 5
</code></pre>

<h3>Option 2: Custom Source (Advanced)</h3>

<ol>
<li>Create source directory:</li>
</ol>

<pre><code>mkdir -p sources/active/custom/newsource
</code></pre>

<ol>
<li>Implement source class:</li>
</ol>

<pre><code># sources/active/custom/newsource/source.py
from core.source_system.base_source import BaseSource

class NewSource(BaseSource):
    def __init__(self):
        super().__init__()
        self.name = &quot;newsource&quot;
        self.display_name = &quot;New Source&quot;

    def get_articles(self, count=30):
        # Implementation here
        pass

    def get_article_content(self, url):
        # Implementation here
        pass
</code></pre>

<ol>
<li>Validate implementation:</li>
</ol>

<pre><code>./capcat fetch newsource --count 5
</code></pre>

<h3>Code Style Guidelines</h3>

<p>Follow PEP 8 standards:</p>

<ul>
<li>4 spaces for indentation</li>
<li>Maximum line length: 79 characters</li>
<li>Use descriptive variable names</li>
<li>Add type hints to function signatures</li>
<li>Write docstrings for all public functions</li>
</ul>

<p>Example:</p>

<pre><code>def process_article(url: str, output_dir: Path) -&gt; Optional[Article]:
    &quot;&quot;&quot;
    Process a single article from URL.

    Args:
        url: Article URL to process
        output_dir: Directory for output files

    Returns:
        Article object if successful, None otherwise

    Raises:
        SourceError: If article cannot be fetched
        FileSystemError: If output cannot be written
    &quot;&quot;&quot;
    # Implementation here
    pass
</code></pre>

<h3>Development Validation</h3>

<p>Verify your changes work correctly:</p>

<pre><code># Fetch from source
./capcat fetch sourcename --count 5

# Try bundle
./capcat bundle tech --count 10
</code></pre>

<h3>Documentation</h3>

<p>Update documentation when making changes:</p>

<pre><code># Generate documentation
python scripts/doc_generator.py

# Update architecture diagrams
python scripts/generate_diagrams.py
</code></pre>

<h3>Debugging</h3>

<p>Enable debug logging:</p>

<pre><code># Enable debug mode
export CAPCAT_DEBUG=1
./capcat fetch hn --count 5

# Or use Python directly
python capcat.py --debug fetch hn --count 5
</code></pre>

<p>Common debugging techniques:</p>

<ol>
<li><h4>Source Issues</h4> Check robots.txt and rate limiting</li>
<li><h4>Media Problems</h4> Verify URLs and file permissions</li>
<li><h4>HTML Parsing</h4> Use browser dev tools to inspect selectors</li>
<li><h4>Performance</h4> Profile with <code>cProfile</code> for bottlenecks</li>
</ol>

<h3>Contributing</h3>

<ol>
<li>Fork the repository</li>
<li>Create a feature branch: <code>git checkout -b feature/new-feature</code></li>
<li>Make your changes following the guidelines</li>
<li>Update documentation as needed</li>
<li>Commit with descriptive messages</li>
<li>Push to your fork and create a pull request</li>
</ol>

<h3>Performance Considerations</h3>

<ul>
<li><h4>Parallel Processing</h4> Use ThreadPoolExecutor for concurrent operations</li>
<li><h4>Session Pooling</h4> Reuse HTTP connections via SessionPool</li>
<li><h4>Rate Limiting</h4> Respect source rate limits (1 req/10 sec default)</li>
<li><h4>Memory Usage</h4> Process articles in batches for large collections</li>
<li><h4>Caching</h4> Implement caching for frequently accessed data</li>
</ul>

<h3>Error Handling</h3>

<p>Implement comprehensive error handling:</p>

<pre><code>from core.exceptions import SourceError, FileSystemError

try:
    article = fetch_article(url)
except SourceError as e:
    logger.error(f&quot;Source error: {e}&quot;)
    return None
except FileSystemError as e:
    logger.error(f&quot;File system error: {e}&quot;)
    raise
except Exception as e:
    logger.exception(f&quot;Unexpected error: {e}&quot;)
    return None
</code></pre>

<h3>Security Considerations</h3>

<ul>
<li>Validate all external inputs</li>
<li>Sanitize HTML content before processing</li>
<li>Use secure file paths (avoid path traversal)</li>
<li>Implement rate limiting to prevent abuse</li>
<li>Follow ethical scraping guidelines</li>
</ul>


<script type="module">
  import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.esm.min.mjs';
    mermaid.initialize({
    startOnLoad: true,
    theme: 'base',
    themeVariables: {
      // Primary colors from design system (Capcat orange palette)
      primaryColor: '#FFD4B7',           // --orange-200
      primaryTextColor: '#201419',       // --ink
      primaryBorderColor: '#F1540E',     // --orange-500 / --accent-primary

      // Line and edge colors
      lineColor: '#58444c',              // --ink-medium

      // Secondary colors
      secondaryColor: '#FFEADB',         // --orange-100
      tertiaryColor: '#f9f8ed',          // --accent-cream-primary

      // Text colors
      textColor: '#201419',              // --ink
      mainBkg: '#FAF8EE',                // --cream

      // Node styling
      nodeBorder: '#F1540E',             // --accent-primary
      clusterBkg: '#faf2e7',             // --accent-cream-light
      clusterBorder: '#D44400',          // --orange-600 / --accent-hover

      // Font
      fontFamily: '-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif',
      fontSize: '16px'
    },
    flowchart: {
      nodeSpacing: 50,
      rankSpacing: 50,
      padding: 15,
      useMaxWidth: true,
      htmlLabels: true,
      curve: 'basis'
    }
  });

  // Add copy buttons to Mermaid diagrams after rendering
  document.addEventListener('DOMContentLoaded', function() {
    const mermaidDivs = document.querySelectorAll('.mermaid');

    mermaidDivs.forEach(function(mermaidDiv) {
      // Get the original Mermaid source code
      const mermaidSource = mermaidDiv.textContent;

      // Create container wrapper
      const container = document.createElement('div');
      container.className = 'mermaid-container';

      // Create copy button
      const copyBtn = document.createElement('button');
      copyBtn.className = 'mermaid-copy-btn';
      copyBtn.textContent = 'Copy Mermaid Code';
      copyBtn.setAttribute('title', 'Copy diagram code for Draw.io, Mermaid Live, etc.');

      copyBtn.addEventListener('click', function() {
        navigator.clipboard.writeText(mermaidSource).then(function() {
          copyBtn.textContent = 'Copied!';
          copyBtn.classList.add('copied');

          setTimeout(function() {
            copyBtn.textContent = 'Copy Mermaid Code';
            copyBtn.classList.remove('copied');
          }, 2000);
        });
      });

      // Wrap the mermaid div in container and add button
      mermaidDiv.parentNode.insertBefore(container, mermaidDiv);
      container.appendChild(mermaidDiv);
      container.appendChild(copyBtn);
    });
  });
</script>
    
    
    <script src="../../js/main.js"></script>

            </div>
        </div>
    </div>

    <!-- Footer -->
    {% include footer.html %}

    <!-- Back to Top Button -->
    <button id="backToTopBtn" title="Go to top">
        <svg xmlns="http://www.w3.org/2000/svg" height="24" viewBox="0 0 24 24" width="24">
            <path d="M0 0h24v24H0V0z" fill="none"/>
            <path fill="currentColor" d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6 1.41 1.41z"/>
        </svg>
    </button>  </body>
