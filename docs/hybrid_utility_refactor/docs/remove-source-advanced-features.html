<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Advanced Features: Enhanced Remove-Source</title>
    <link rel="stylesheet" href="../css/design-system.css">
    <link rel="stylesheet" href="../css/main.css">
</head>
<body>
    <!-- Header -->
    <div id="header-placeholder"></div>


    <div class="doc-container">
        <div class="container">
            <div class="doc-content">

<div class="nav-breadcrumb"><a href="index.html">Documentation Home</a></div>
<h1>Advanced Features: Enhanced Remove-Source</h1>

<h2>Overview</h2>

<p>The remove-source command now includes six powerful enhancements for safer, smarter source management:</p>

<ol>
<li><h4>Dry-Run Mode</h4> - Preview changes before executing</li>
<li><h4>Automatic Backups</h4> - Safe removal with undo capability</li>
<li><h4>Usage Analytics</h4> - Data-driven removal decisions</li>
<li><h4>Batch Removal</h4> - Remove multiple sources from file</li>
<li><h4>Undo/Restore</h4> - Restore previously removed sources</li>
<li><h4>Integration</h4> - Analytics integrated into workflow</li>
</ol>

<h2>Feature Details</h2>

<h3>1. Dry-Run Mode</h3>

<p>Preview exactly what will be removed without making any changes.</p>

<h4>Usage:</h4>
<pre><code>./capcat remove-source --dry-run
</code></pre>

<h4>Output:</h4>
<pre><code>--- Source Usage Analytics ---
Most Active Sources:
  Hacker News: 45 fetches, daily
  BBC News: 12 fetches, weekly

--- Removal Summary ---
  Source: InfoQ (iq)
  Config: .../configs/iq.yml
  Bundles: tech

[DRY RUN] No changes made.

Actions that would be performed:
  InfoQ (iq):
    - Delete: .../configs/iq.yml
    - Remove from bundles: tech

To execute, run without --dry-run flag.
</code></pre>

<h4>Benefits:</h4>
<ul>
<li>Verify correct sources selected</li>
<li>See bundle impact before removal</li>
<li>No risk of accidental deletion</li>
<li>Perfect for learning the tool</li>
</ul>

<h3>2. Automatic Backups</h3>

<p>Every removal creates a timestamped backup for safety.</p>

<h4>Default Behavior:</h4>
<pre><code>./capcat remove-source
# Automatic backup created
</code></pre>

<h4>Skip Backup</h4> (not recommended):
<pre><code>./capcat remove-source --no-backup
</code></pre>

<h4>Backup Structure:</h4>
<div class="ascii-art">.capcat_backups/
└── removal_20250118_143022/
    ├── metadata.json
    ├── configs/
    │   ├── hn.yml
    │   └── bbc.yml
    └── bundles.yml
</div>

<h4>Metadata Example:</h4>
<pre><code>{
  &quot;backup_id&quot;: &quot;removal_20250118_143022&quot;,
  &quot;timestamp&quot;: &quot;2025-01-18T14:30:22.123456&quot;,
  &quot;sources&quot;: [&quot;hn&quot;, &quot;bbc&quot;],
  &quot;bundle_backup&quot;: &quot;/path/to/bundles.yml&quot;
}
</code></pre>

<h4>Automatic Cleanup:</h4>
<ul>
<li>Keeps 10 most recent backups by default</li>
<li>Older backups automatically pruned</li>
<li>Manual cleanup available</li>
</ul>

<h3>3. Usage Analytics</h3>

<p>Make informed decisions based on actual usage patterns.</p>

<h4>Tracked Metrics:</h4>
<ul>
<li>Total fetches</li>
<li>Success/failure rates</li>
<li>Last used date</li>
<li>Fetch frequency (daily/weekly/monthly/rarely/never)</li>
<li>Articles fetched count</li>
<li>Average articles per fetch</li>
</ul>

<h4>Analytics Display:</h4>
<pre><code>--- Source Usage Analytics ---

Most Active Sources:
  Hacker News: 45 fetches, daily
  BBC News: 12 fetches, weekly
  InfoQ: 3 fetches, monthly

Unused sources (2): old_source1, old_source2

--- Selected Sources Analytics ---

InfoQ (iq)
  Fetches: 3, Frequency: monthly
  [CONSIDER] Rarely used

BBC News (bbc)
  Fetches: 12, Frequency: weekly
  [ACTIVE] Regular use
</code></pre>

<h4>Recommendation Categories:</h4>
<ul>
<li><code>[RECOMMENDED]</code> - Never used or 90+ days inactive</li>
<li><code>[WARNING]</code> - Low success rate (&lt;30%)</li>
<li><code>[CONSIDER]</code> - Rarely used</li>
<li><code>[ACTIVE]</code> - Regular use</li>
</ul>

<h4>Skip Analytics:</h4>
<pre><code>./capcat remove-source --no-analytics
</code></pre>

<h4>Analytics File Location:</h4>
<pre><code>.capcat_analytics/usage.json
</code></pre>

<h3>4. Batch Removal</h3>

<p>Remove multiple sources from a file list.</p>

<h4>Create Batch File:</h4>
<pre><code>cat &gt; sources_to_remove.txt &lt;&lt;EOF
# Sources to remove
hn
bbc
old_source1
old_source2
# Lines starting with # are ignored
EOF
</code></pre>

<h4>Execute Batch Removal:</h4>
<pre><code>./capcat remove-source --batch sources_to_remove.txt
</code></pre>

<h4>Output:</h4>
<pre><code>Batch removal: 4 sources from sources_to_remove.txt

--- Removal Summary ---
  Source: Hacker News (hn)
  Config: .../hn.yml
  Bundles: tech, techpro

  Source: BBC News (bbc)
  Config: .../bbc.yml
  Bundles: news

  Remove 4 source(s)? This cannot be undone. Yes

Batch removal complete: 4 sources removed.
Backup: removal_20250118_143500
</code></pre>

<h4>Batch + Dry-Run:</h4>
<pre><code>./capcat remove-source --batch sources.txt --dry-run
</code></pre>

<h4>Force Mode</h4> (skip confirmations):
<pre><code>./capcat remove-source --batch sources.txt --force
</code></pre>

<h3>5. Undo/Restore Functionality</h3>

<p>Restore previously removed sources from backups.</p>

<h4>Undo Last Removal:</h4>
<pre><code>./capcat remove-source --undo
</code></pre>

<h4>Undo Specific Backup:</h4>
<pre><code>./capcat remove-source --undo removal_20250118_143022
</code></pre>

<h4>Interactive Selection:</h4>
<pre><code>--- Restore Sources from Backup ---

  Select backup to restore:
&gt; removal_20250118_143022 - 2 sources - 2025-01-18 14:30:22
  removal_20250118_100500 - 1 sources - 2025-01-18 10:05:00

Restoring backup: removal_20250118_143022
Timestamp: 2025-01-18T14:30:22.123456
Sources: hn, bbc

  Proceed with restore? No

Restore cancelled.
</code></pre>

<h4>After Restore:</h4>
<ul>
<li>Config files restored to original location</li>
<li>Bundles.yml restored</li>
<li>Registry automatically refreshed</li>
<li>Sources immediately available</li>
</ul>

<h3>6. Integration with Analytics</h3>

<p>Analytics are seamlessly integrated into the workflow.</p>

<h4>Before Selection:</h4>
<p>Shows most active sources and unused sources to help decision-making.</p>

<h4>After Selection:</h4>
<p>Shows detailed stats for each selected source with recommendations.</p>

<h4>Continuous Tracking:</h4>
<p>Analytics persist across sessions for historical insights.</p>

<h2>Command Reference</h2>

<h3>Basic Commands</h3>
<pre><code># Interactive removal
./capcat remove-source

# Preview changes
./capcat remove-source --dry-run

# Remove without backup
./capcat remove-source --no-backup

# Remove without analytics
./capcat remove-source --no-analytics

# Force (skip confirmations)
./capcat remove-source --force
</code></pre>

<h3>Batch Operations</h3>
<pre><code># Batch removal
./capcat remove-source --batch sources.txt

# Batch with dry-run
./capcat remove-source --batch sources.txt --dry-run

# Batch with force
./capcat remove-source --batch sources.txt --force
</code></pre>

<h3>Undo Operations</h3>
<pre><code># Undo last removal
./capcat remove-source --undo

# Undo specific backup
./capcat remove-source --undo removal_20250118_143022
</code></pre>

<h3>Combined Flags</h3>
<pre><code># Dry-run without analytics
./capcat remove-source --dry-run --no-analytics

# Batch removal without backup (not recommended)
./capcat remove-source --batch sources.txt --no-backup

# Force batch removal
./capcat remove-source --batch sources.txt --force
</code></pre>

<h2>Use Cases</h2>

<h3>Scenario 1: Clean Up Unused Sources</h3>

<pre><code># Check what&#x27;s unused (dry-run)
./capcat remove-source --dry-run

# Analytics will show:
# - Unused sources (never used or 30+ days)
# - Low performers (poor success rates)

# Selectively remove based on data
./capcat remove-source
</code></pre>

<h3>Scenario 2: Bulk Cleanup</h3>

<pre><code># Create list of sources to remove
echo &quot;old_source1
old_source2
old_source3&quot; &gt; cleanup.txt

# Preview the cleanup
./capcat remove-source --batch cleanup.txt --dry-run

# Execute cleanup
./capcat remove-source --batch cleanup.txt
</code></pre>

<h3>Scenario 3: Safe Experimentation</h3>

<pre><code># Remove a source (backup created automatically)
./capcat remove-source

# Try the system without it

# Changed your mind? Undo it!
./capcat remove-source --undo
</code></pre>

<h3>Scenario 4: Production Migration</h3>

<pre><code># List sources to migrate off old server
cat &gt; migrate.txt &lt;&lt;EOF
legacy_source1
legacy_source2
legacy_source3
EOF

# Preview impact
./capcat remove-source --batch migrate.txt --dry-run

# Check analytics for usage patterns
# Shows which sources are still active

# Execute with force for automation
./capcat remove-source --batch migrate.txt --force
</code></pre>

<h2>File Locations</h2>

<h3>Backups</h3>
<div class="ascii-art">.capcat_backups/
└── removal_YYYYMMDD_HHMMSS/
    ├── metadata.json
    ├── configs/
    └── bundles.yml
</div>

<h3>Analytics</h3>
<div class="ascii-art">.capcat_analytics/
└── usage.json
</div>

<h3>Batch Files</h3>
<pre><code>Any text file, one source ID per line
# Comments allowed
</code></pre>

<h2>Best Practices</h2>

<h3>Always Use Dry-Run First</h3>
<pre><code>./capcat remove-source --dry-run
</code></pre>
<p>Verify selections before executing.</p>

<h3>Review Analytics</h3>
<p>Pay attention to recommendation tags:</p>
<ul>
<li><code>[RECOMMENDED]</code> - Safe to remove</li>
<li><code>[WARNING]</code> - Investigate first</li>
<li><code>[ACTIVE]</code> - Keep unless necessary</li>
</ul>

<h3>Keep Backups Enabled</h3>
<p>Only use <code>--no-backup</code> when absolutely certain.</p>

<h3>Use Batch Files for Documentation</h3>
<p>Batch files serve as documentation of why sources were removed:</p>
<pre><code>cat &gt; deprecated_sources.txt &lt;&lt;EOF
# Deprecated sources - replaced 2025-01-18
# Reason: Moving to new API-based sources
old_api_source1
old_api_source2
EOF
</code></pre>

<h3>Test Restore Procedure</h3>
<p>Periodically verify undo functionality works:</p>
<pre><code># Remove a test source
./capcat remove-source  # Remove test_source

# Verify it&#x27;s gone
./capcat list sources

# Restore it
./capcat remove-source --undo

# Verify it&#x27;s back
./capcat list sources
</code></pre>

<h2>Troubleshooting</h2>

<h3>Backup Not Created</h3>
<h4>Problem:</h4> No backup message shown
<h4>Solution:</h4> Check <code>.capcat_backups/</code> directory exists and is writable

<h3>Analytics Not Showing</h3>
<h4>Problem:</h4> No usage statistics displayed
<h4>Solution:</h4> Analytics require usage history. New installations won&#x27;t have data yet.

<h3>Undo Fails</h3>
<h4>Problem:</h4> Cannot restore backup
<h4>Solution:</h4> Verify backup exists in <code>.capcat_backups/</code> directory

<h3>Batch File Errors</h3>
<h4>Problem:</h4> Sources not found in batch file
<h4>Solution:</h4> Verify source IDs are correct with <code>./capcat list sources</code>

<h2>Performance Considerations</h2>

<h3>Analytics Overhead</h3>
<ul>
<li>Minimal: JSON file I/O only</li>
<li>No impact on fetch operations</li>
<li>File size: ~1KB per source</li>
</ul>

<h3>Backup Space</h3>
<ul>
<li>Each backup: ~few KB per source</li>
<li>Auto-cleanup keeps 10 most recent</li>
<li>Manual cleanup available</li>
</ul>

<h3>Restore Speed</h3>
<ul>
<li>Instant for small configs</li>
<li>Scales linearly with file count</li>
</ul>

<h2>Security Notes</h2>

<h3>Backup Files</h3>
<ul>
<li>Contain sensitive source configurations</li>
<li>Stored in <code>.capcat_backups/</code> (git-ignored)</li>
<li>No credentials stored (only configs)</li>
</ul>

<h3>Analytics Data</h3>
<ul>
<li>Usage metrics only</li>
<li>No article content</li>
<li>No personal information</li>
</ul>

<h3>File Permissions</h3>
<ul>
<li>Backups inherit source directory permissions</li>
<li>Analytics file created with user permissions</li>
</ul>

<script type="module">
  import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.esm.min.mjs';
    mermaid.initialize({
    startOnLoad: true,
    theme: 'base',
    themeVariables: {
      // Primary colors from design system (Capcat orange palette)
      primaryColor: '#FFD4B7',           // --orange-200
      primaryTextColor: '#201419',       // --ink
      primaryBorderColor: '#F1540E',     // --orange-500 / --accent-primary

      // Line and edge colors
      lineColor: '#58444c',              // --ink-medium

      // Secondary colors
      secondaryColor: '#FFEADB',         // --orange-100
      tertiaryColor: '#f9f8ed',          // --accent-cream-primary

      // Text colors
      textColor: '#201419',              // --ink
      mainBkg: '#FAF8EE',                // --cream

      // Node styling
      nodeBorder: '#F1540E',             // --accent-primary
      clusterBkg: '#faf2e7',             // --accent-cream-light
      clusterBorder: '#D44400',          // --orange-600 / --accent-hover

      // Font
      fontFamily: '-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif',
      fontSize: '16px'
    },
    flowchart: {
      nodeSpacing: 50,
      rankSpacing: 50,
      padding: 15,
      useMaxWidth: true,
      htmlLabels: true,
      curve: 'basis'
    }
  });

  // Add copy buttons to Mermaid diagrams after rendering
  document.addEventListener('DOMContentLoaded', function() {
    const mermaidDivs = document.querySelectorAll('.mermaid');

    mermaidDivs.forEach(function(mermaidDiv) {
      // Get the original Mermaid source code
      const mermaidSource = mermaidDiv.textContent;

      // Create container wrapper
      const container = document.createElement('div');
      container.className = 'mermaid-container';

      // Create copy button
      const copyBtn = document.createElement('button');
      copyBtn.className = 'mermaid-copy-btn';
      copyBtn.textContent = 'Copy Mermaid Code';
      copyBtn.setAttribute('title', 'Copy diagram code for Draw.io, Mermaid Live, etc.');

      copyBtn.addEventListener('click', function() {
        navigator.clipboard.writeText(mermaidSource).then(function() {
          copyBtn.textContent = 'Copied!';
          copyBtn.classList.add('copied');

          setTimeout(function() {
            copyBtn.textContent = 'Copy Mermaid Code';
            copyBtn.classList.remove('copied');
          }, 2000);
        });
      });

      // Wrap the mermaid div in container and add button
      mermaidDiv.parentNode.insertBefore(container, mermaidDiv);
      container.appendChild(mermaidDiv);
      container.appendChild(copyBtn);
    });
  });
</script>
    <script src="../js/main.js"></script>

            </div>
        </div>
    </div>

    <!-- Footer -->
    <div id="footer-placeholder"></div>

    <!-- Back to Top Button -->
    <button id="backToTopBtn" title="Go to top">
        <svg xmlns="http://www.w3.org/2000/svg" height="24" viewBox="0 0 24 24" width="24">
            <path d="M0 0h24v24H0V0z" fill="none"/>
            <path fill="currentColor" d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6 1.41 1.41z"/>
        </svg>
    </button>

    <script src="../../js/includes-loader.js"></script>
  </body>
