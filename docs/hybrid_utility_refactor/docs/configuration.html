<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Configuration Guide</title>
    <link rel="stylesheet" href="../css/design-system.css">
    <link rel="stylesheet" href="../css/main.css">
</head>
<body>
    <!-- Header -->
    <div id="header-placeholder"></div>


    <div class="doc-container">
        <div class="container">
            <div class="doc-content">

<div class="nav-breadcrumb"><a href="index.html">Documentation Home</a></div>
<h1>Configuration Guide</h1>

<p>Comprehensive guide for configuring Capcat&#x27;s hybrid architecture system and individual sources.</p>

<h2>Configuration Hierarchy</h2>

<p>Capcat uses a hierarchical configuration system with the following precedence (highest to lowest):</p>

<ol>
<li><h4>Command-line arguments</h4> (highest priority)</li>
<li><h4>Environment variables</h4></li>
<li><h4>Configuration files</h4> (<code>capcat.yml</code>, <code>capcat.json</code>)</li>
<li><h4>Default values</h4> (lowest priority)</li>
</ol>

<h2>System Configuration</h2>

<h3>Configuration Files</h3>

<p>Create configuration files in the application root directory:</p>

<h3>YAML Configuration (Recommended)</h3>
<pre><code># capcat.yml
network:
  connect_timeout: 10
  read_timeout: 8
  user_agent: &quot;Mozilla/5.0 (compatible; Capcat/2.0)&quot;
  max_retries: 3
  retry_delay: 1.0

processing:
  max_workers: 8
  download_images: true
  download_videos: false
  download_audio: false
  download_documents: false

logging:
  default_level: &quot;INFO&quot;
  use_colors: true

output:
  base_path: &quot;../&quot;
  date_format: &quot;%d-%m-%Y&quot;
  create_date_folders: true
</code></pre>

<h3>JSON Configuration</h3>
<pre><code>{
  &quot;network&quot;: {
    &quot;connect_timeout&quot;: 10,
    &quot;read_timeout&quot;: 8,
    &quot;user_agent&quot;: &quot;Mozilla/5.0 (compatible; Capcat/2.0)&quot;,
    &quot;max_retries&quot;: 3,
    &quot;retry_delay&quot;: 1.0
  },
  &quot;processing&quot;: {
    &quot;max_workers&quot;: 8,
    &quot;download_images&quot;: true,
    &quot;download_videos&quot;: false,
    &quot;download_audio&quot;: false,
    &quot;download_documents&quot;: false
  },
  &quot;logging&quot;: {
    &quot;default_level&quot;: &quot;INFO&quot;,
    &quot;use_colors&quot;: true
  },
  &quot;output&quot;: {
    &quot;base_path&quot;: &quot;../&quot;,
    &quot;date_format&quot;: &quot;%d-%m-%Y&quot;,
    &quot;create_date_folders&quot;: true
  }
}
</code></pre>

<h3>Environment Variables</h3>

<p>All configuration options can be overridden with environment variables using the <code>CAPCAT_</code> prefix:</p>

<pre><code># Network configuration
export CAPCAT_NETWORK_CONNECT_TIMEOUT=15
export CAPCAT_NETWORK_READ_TIMEOUT=10
export CAPCAT_NETWORK_USER_AGENT=&quot;Custom User Agent&quot;

# Processing configuration
export CAPCAT_PROCESSING_MAX_WORKERS=12
export CAPCAT_PROCESSING_DOWNLOAD_VIDEOS=true

# Logging configuration
export CAPCAT_LOGGING_DEFAULT_LEVEL=DEBUG
export CAPCAT_LOGGING_USE_COLORS=false
</code></pre>

<h3>Command-Line Overrides</h3>

<p>Command-line arguments override all other configuration sources:</p>

<pre><code># Override worker count
./capcat bundle tech --count 10 --workers 12

# Override media downloading
./capcat fetch hn,bbc --count 15 --media

# Override output path
./capcat single https://example.com/article --output /custom/path

# Enable file logging (all commands)
./capcat --log-file capcat.log bundle tech --count 10

# Verbose console + file logging
./capcat -V -L debug.log fetch hn --count 15
</code></pre>

<h2>Configuration Sections</h2>

<h3>Network Configuration</h3>

<p>Controls HTTP requests and network behavior.</p>

<pre><code>network:
  connect_timeout: 10          # Connection timeout (seconds)
  read_timeout: 8             # Read timeout (seconds)
  user_agent: &quot;Mozilla/5.0 (compatible; Capcat/2.0)&quot;
  max_retries: 3              # Maximum retry attempts
  retry_delay: 1.0            # Delay between retries (seconds)
  pool_connections: 20        # Connection pool size
  pool_maxsize: 20           # Maximum pool size
</code></pre>

<h4>Options:</h4>
<ul>
<li><code>connect_timeout</code>: Maximum time to wait for connection establishment</li>
<li><code>read_timeout</code>: Maximum time to wait for response data</li>
<li><code>user_agent</code>: User-Agent header for HTTP requests</li>
<li><code>max_retries</code>: Number of retry attempts for failed requests</li>
<li><code>retry_delay</code>: Base delay between retry attempts</li>
<li><code>pool_connections</code>: Number of connection pools to cache</li>
<li><code>pool_maxsize</code>: Maximum number of connections to save in pool</li>
</ul>

<h3>Processing Configuration</h3>

<p>Controls article processing and download behavior.</p>

<pre><code>processing:
  max_workers: 8              # Parallel processing workers
  download_images: true       # Download and embed images
  download_videos: false      # Download video files
  download_audio: false       # Download audio files
  download_documents: false   # Download PDF/document files
  skip_existing: true         # Skip existing articles
  content_timeout: 30         # Content fetching timeout
</code></pre>

<h4>Options:</h4>
<ul>
<li><code>max_workers</code>: Number of parallel ThreadPoolExecutor workers</li>
<li><code>download_images</code>: Always download images (embedded in articles)</li>
<li><code>download_videos</code>: Download video files (requires --media flag)</li>
<li><code>download_audio</code>: Download audio files (requires --media flag)</li>
<li><code>download_documents</code>: Download PDF/document files (requires --media flag)</li>
<li><code>skip_existing</code>: Skip articles that already exist</li>
<li><code>content_timeout</code>: Timeout for content fetching operations</li>
</ul>

<h3>Logging Configuration</h3>

<p>Controls logging behavior and output.</p>

<pre><code>logging:
  default_level: &quot;INFO&quot;       # Default log level (DEBUG, INFO, WARNING, ERROR)
  use_colors: true           # Colored console output
</code></pre>

<h4>Log Levels:</h4>
<ul>
<li><code>DEBUG</code>: Detailed debugging information</li>
<li><code>INFO</code>: General information (default)</li>
<li><code>WARNING</code>: Warning messages</li>
<li><code>ERROR</code>: Error messages only</li>
<li><code>CRITICAL</code>: Critical errors only</li>
</ul>

<h4>File Logging:</h4>

<p>File logging is controlled via CLI flags, not configuration files:</p>

<pre><code># Enable file logging with --log-file or -L flag
./capcat --log-file capcat.log bundle tech --count 10

# Verbose console + file logging
./capcat -V -L debug.log fetch hn --count 15

# Timestamped log files
./capcat -L logs/news-$(date +%Y%m%d-%H%M%S).log bundle news --count 10
</code></pre>

<h4>Log Output Formats:</h4>
<ul>
<li><h4>Console</h4> Colored output with log level indicators (user-friendly)</li>
<li><h4>File</h4> Timestamped entries with module names and full context (debugging)</li>
</ul>

<h3>Output Configuration</h3>

<p>Controls output directory structure and file naming.</p>

<pre><code>output:
  base_path: &quot;../&quot;           # Base output directory
  date_format: &quot;%d-%m-%Y&quot;    # Date format for folders
  create_date_folders: true  # Create date-based folders
  sanitize_filenames: true   # Clean invalid filename characters
  max_filename_length: 100   # Maximum filename length
</code></pre>

<h4>Options:</h4>
<ul>
<li><code>base_path</code>: Base directory for all output</li>
<li><code>date_format</code>: Python strftime format for date folders</li>
<li><code>create_date_folders</code>: Create date-based organization</li>
<li><code>sanitize_filenames</code>: Remove invalid filesystem characters</li>
<li><code>max_filename_length</code>: Truncate long filenames</li>
</ul>

<h2>Source Configuration</h2>

<h3>Config-Driven Sources</h3>

<p>Simple sources use YAML configuration files in <code>sources/active/config_driven/configs/</code>.</p>

<h3>Basic Configuration</h3>
<pre><code># sources/active/config_driven/configs/example.yaml
display_name: &quot;Example News&quot;
base_url: &quot;https://example.com/news/&quot;
category: &quot;general&quot;          # tech, science, business, general
timeout: 10.0
rate_limit: 1.0             # Minimum seconds between requests

# Required: Article discovery
article_selectors:
  - &quot;.headline a&quot;
  - &quot;.article-title a&quot;
  - &quot;h2.title a&quot;

# Required: Content extraction
content_selectors:
  - &quot;.article-content&quot;
  - &quot;.post-body&quot;
  - &quot;div.content&quot;
</code></pre>

<h3>Advanced Configuration</h3>
<pre><code># Advanced config-driven source
display_name: &quot;Advanced News&quot;
base_url: &quot;https://advanced.com/&quot;
category: &quot;tech&quot;
timeout: 15.0
rate_limit: 2.0
supports_comments: false

article_selectors:
  - &quot;.headline a&quot;
  - &quot;.story-link&quot;

content_selectors:
  - &quot;.article-content&quot;
  - &quot;.story-body&quot;

# Skip unwanted URLs
skip_patterns:
  - &quot;/about&quot;
  - &quot;/contact&quot;
  - &quot;/advertising&quot;
  - &quot;?utm_&quot;
  - &quot;/sponsored&quot;

# Custom headers
custom_config:
  headers:
    Accept: &quot;text/html,application/xhtml+xml&quot;
    Accept-Language: &quot;en-US,en;q=0.5&quot;
  user_agent: &quot;Custom Bot 1.0&quot;

  # Custom selectors for metadata
  meta_selectors:
    author: &quot;.byline .author&quot;
    date: &quot;.publish-date&quot;
    tags: &quot;.article-tags a&quot;

  # Content cleaning
  remove_selectors:
    - &quot;.advertisement&quot;
    - &quot;.related-links&quot;
    - &quot;.social-share&quot;
</code></pre>

<h3>Custom Sources</h3>

<p>Complex sources use Python implementations with YAML configuration.</p>

<h3>Configuration File</h3>
<pre><code># sources/active/custom/example/config.yaml
display_name: &quot;Example Custom&quot;
base_url: &quot;https://example.com/&quot;
category: &quot;tech&quot;
timeout: 10.0
rate_limit: 1.0
supports_comments: true

# Custom source-specific configuration
custom_config:
  api_endpoint: &quot;/api/v1/articles&quot;
  api_key: &quot;${EXAMPLE_API_KEY}&quot;  # Environment variable
  max_pages: 5
  items_per_page: 50

  # Authentication
  auth_type: &quot;bearer&quot;  # bearer, basic, api_key
  auth_header: &quot;Authorization&quot;

  # Rate limiting
  requests_per_minute: 60
  burst_limit: 10

  # Content processing
  extract_metadata: true
  process_images: true
  follow_redirects: true
</code></pre>

<h3>Python Implementation</h3>
<pre><code># sources/active/custom/example/source.py
class ExampleSource(BaseSource):
    def __init__(self, config: SourceConfig, session=None):
        super().__init__(config, session)

        # Access custom configuration
        self.api_key = config.custom_config.get(&#x27;api_key&#x27;)
        self.api_endpoint = config.custom_config.get(&#x27;api_endpoint&#x27;)
        self.max_pages = config.custom_config.get(&#x27;max_pages&#x27;, 5)

    def _get_headers(self):
        headers = super()._get_headers()

        # Add API authentication
        if self.api_key:
            headers[&#x27;Authorization&#x27;] = f&#x27;Bearer {self.api_key}&#x27;

        return headers
</code></pre>

<h2>Configuration Validation</h2>

<h3>Automatic Validation</h3>

<p>Capcat automatically validates configurations during source discovery:</p>

<pre><code># Check configuration validity
from core.source_system.source_registry import get_source_registry

registry = get_source_registry()
errors = registry.validate_all_sources(deep_validation=True)

for source_name, error_list in errors.items():
    if error_list:
        print(f&quot;{source_name}: {&#x27;, &#x27;.join(error_list)}&quot;)
</code></pre>

<h3>Manual Validation</h3>

<pre><code># Validate all sources
python -c &quot;
from core.source_system.validation_engine import ValidationEngine
from core.source_system.source_registry import get_source_registry

registry = get_source_registry()
engine = ValidationEngine()

configs = registry.discover_sources()
results = engine.validate_all_sources(configs, deep_validation=True)
report = engine.generate_validation_report(results)
print(report)
&quot;
</code></pre>

<h2>Environment-Specific Configuration</h2>

<h3>Development Environment</h3>
<pre><code># capcat-dev.yml
network:
  connect_timeout: 5
  read_timeout: 5
  max_retries: 1

processing:
  max_workers: 4
  download_videos: false

logging:
  default_level: &quot;DEBUG&quot;
  use_colors: true
  log_to_file: true
</code></pre>

<h3>Production Environment</h3>
<pre><code># capcat-prod.yml
network:
  connect_timeout: 15
  read_timeout: 10
  max_retries: 3
  retry_delay: 2.0

processing:
  max_workers: 16
  download_images: true
  download_videos: true

logging:
  default_level: &quot;INFO&quot;
  use_colors: false
  log_to_file: true
  format: &quot;json&quot;
</code></pre>

<h3>Testing Environment</h3>
<pre><code># capcat-test.yml
network:
  connect_timeout: 3
  read_timeout: 3
  max_retries: 0

processing:
  max_workers: 2
  download_images: false
  download_videos: false

logging:
  default_level: &quot;WARNING&quot;
  use_colors: false
</code></pre>

<h2>Security Configuration</h2>

<h3>API Keys and Secrets</h3>

<p>Use environment variables for sensitive data:</p>

<pre><code># Configuration file
custom_config:
  api_key: &quot;${NEWS_API_KEY}&quot;
  secret_token: &quot;${SECRET_TOKEN}&quot;
  database_url: &quot;${DATABASE_URL}&quot;
</code></pre>

<pre><code># Environment variables
export NEWS_API_KEY=&quot;your-api-key-here&quot;
export SECRET_TOKEN=&quot;your-secret-token&quot;
export DATABASE_URL=&quot;postgresql://user:pass@localhost/db&quot;
</code></pre>

<h3>User Agent Configuration</h3>

<p>Use realistic user agents to avoid being blocked:</p>

<pre><code>network:
  user_agent: &quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/91.0.4472.124 Safari/537.36&quot;
</code></pre>

<h3>Rate Limiting</h3>

<p>Configure appropriate rate limits to respect server resources:</p>

<pre><code># Global rate limiting
network:
  retry_delay: 2.0

# Per-source rate limiting
rate_limit: 1.5  # Minimum 1.5 seconds between requests
</code></pre>

<h2>Performance Tuning</h2>

<h3>High-Performance Configuration</h3>
<pre><code>network:
  connect_timeout: 8
  read_timeout: 6
  pool_connections: 50
  pool_maxsize: 50

processing:
  max_workers: 16  # Adjust based on CPU cores
  skip_existing: true
  content_timeout: 20
</code></pre>

<h3>Memory-Constrained Configuration</h3>
<pre><code>processing:
  max_workers: 4
  download_videos: false
  download_audio: false
  download_documents: false

logging:
  log_to_file: false  # Reduce memory usage
</code></pre>

<h2>Configuration Examples</h2>

<h3>News Aggregation Setup</h3>
<pre><code># Optimized for news aggregation
processing:
  max_workers: 12
  download_images: true
  download_videos: false

sources:
  priority:
    - &quot;bbc&quot;
    - &quot;cnn&quot;
    - &quot;reuters&quot;

bundles:
  daily_news:
    - &quot;bbc&quot;
    - &quot;cnn&quot;
    - &quot;aljazeera&quot;
    count: 50
</code></pre>

<h3>Research Configuration</h3>
<pre><code># Optimized for research/archival
processing:
  download_images: true
  download_videos: true
  download_documents: true
  skip_existing: false

logging:
  default_level: &quot;DEBUG&quot;
  log_to_file: true

output:
  create_date_folders: true
  sanitize_filenames: true
</code></pre>

<h2>Configuration Management</h2>

<h3>Loading Custom Configuration</h3>
<pre><code># Specify configuration file
export CAPCAT_CONFIG_FILE=&quot;config/production.yml&quot;
./capcat bundle tech --count 10

# Multiple configuration files (merged in order)
export CAPCAT_CONFIG_FILES=&quot;config/base.yml,config/production.yml&quot;
</code></pre>

<h3>Configuration Validation Script</h3>
<pre><code>#!/usr/bin/env python3
&quot;&quot;&quot;Configuration validation script.&quot;&quot;&quot;

import yaml
from pathlib import Path
from core.config import load_config, validate_config

def validate_config_file(config_path):
    &quot;&quot;&quot;Validate a configuration file.&quot;&quot;&quot;
    try:
        config = load_config(config_path)
        errors = validate_config(config)

        if errors:
            print(f&quot;Configuration errors in {config_path}:&quot;)
            for error in errors:
                print(f&quot;  - {error}&quot;)
        else:
            print(f&quot;Configuration valid: {config_path}&quot;)

    except Exception as e:
        print(f&quot;Failed to load {config_path}: {e}&quot;)

if __name__ == &quot;__main__&quot;:
    for config_file in [&quot;capcat.yml&quot;, &quot;capcat.json&quot;]:
        if Path(config_file).exists():
            validate_config_file(config_file)
</code></pre>



<em>This configuration guide covers all aspects of Capcat configuration management. For source-specific configuration details, see the Source Development Guide.</em>

<script type="module">
  import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.esm.min.mjs';
    mermaid.initialize({
    startOnLoad: true,
    theme: 'base',
    themeVariables: {
      // Primary colors from design system (Capcat orange palette)
      primaryColor: '#FFD4B7',           // --orange-200
      primaryTextColor: '#201419',       // --ink
      primaryBorderColor: '#F1540E',     // --orange-500 / --accent-primary

      // Line and edge colors
      lineColor: '#58444c',              // --ink-medium

      // Secondary colors
      secondaryColor: '#FFEADB',         // --orange-100
      tertiaryColor: '#f9f8ed',          // --accent-cream-primary

      // Text colors
      textColor: '#201419',              // --ink
      mainBkg: '#FAF8EE',                // --cream

      // Node styling
      nodeBorder: '#F1540E',             // --accent-primary
      clusterBkg: '#faf2e7',             // --accent-cream-light
      clusterBorder: '#D44400',          // --orange-600 / --accent-hover

      // Font
      fontFamily: '-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif',
      fontSize: '16px'
    },
    flowchart: {
      nodeSpacing: 50,
      rankSpacing: 50,
      padding: 15,
      useMaxWidth: true,
      htmlLabels: true,
      curve: 'basis'
    }
  });

  // Add copy buttons to Mermaid diagrams after rendering
  document.addEventListener('DOMContentLoaded', function() {
    const mermaidDivs = document.querySelectorAll('.mermaid');

    mermaidDivs.forEach(function(mermaidDiv) {
      // Get the original Mermaid source code
      const mermaidSource = mermaidDiv.textContent;

      // Create container wrapper
      const container = document.createElement('div');
      container.className = 'mermaid-container';

      // Create copy button
      const copyBtn = document.createElement('button');
      copyBtn.className = 'mermaid-copy-btn';
      copyBtn.textContent = 'Copy Mermaid Code';
      copyBtn.setAttribute('title', 'Copy diagram code for Draw.io, Mermaid Live, etc.');

      copyBtn.addEventListener('click', function() {
        navigator.clipboard.writeText(mermaidSource).then(function() {
          copyBtn.textContent = 'Copied!';
          copyBtn.classList.add('copied');

          setTimeout(function() {
            copyBtn.textContent = 'Copy Mermaid Code';
            copyBtn.classList.remove('copied');
          }, 2000);
        });
      });

      // Wrap the mermaid div in container and add button
      mermaidDiv.parentNode.insertBefore(container, mermaidDiv);
      container.appendChild(mermaidDiv);
      container.appendChild(copyBtn);
    });
  });
</script>
    <script src="../js/main.js"></script>

            
<nav class="chapter-navigation" aria-label="Chapter navigation">
    <div class="next-chapter-content">
        <span class="next-chapter-label">Next Chapter</span>
        <span class="next-chapter-arrow" aria-hidden="true">â†’</span>
        <a href="interactive-mode.html" class="next-chapter-link" rel="next">Interactive Mode</a>
    </div>
</nav>
</div>
        </div>
    </div>

    <!-- Footer -->
    <div id="footer-placeholder"></div>

    <!-- Back to Top Button -->
    <button id="backToTopBtn" title="Go to top">
        <svg xmlns="http://www.w3.org/2000/svg" height="24" viewBox="0 0 24 24" width="24">
            <path d="M0 0h24v24H0V0z" fill="none"/>
            <path fill="currentColor" d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6 1.41 1.41z"/>
        </svg>
    </button>

    <script src="../../js/includes-loader.js"></script>
  </body>
