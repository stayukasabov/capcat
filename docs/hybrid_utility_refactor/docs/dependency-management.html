<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dependency Management System</title>
    <link rel="stylesheet" href="../css/design-system.css">
    <link rel="stylesheet" href="../css/main.css">
</head>
<body>
    <!-- Header -->
    <div id="header-placeholder"></div>


    <div class="doc-container">
        <div class="container">
            <div class="doc-content">

<div class="nav-breadcrumb"><a href="index.html">Documentation Home</a></div>
<h1>Dependency Management System</h1>

<p>Comprehensive automated dependency management for Capcat with intelligent error detection and repair mechanisms.</p>

<h2>Overview</h2>

<p>The refactored dependency management system provides:</p>
<ul>
<li>Automatic virtual environment validation and repair</li>
<li>Intelligent corruption detection (hardcoded paths, missing files, broken executables)</li>
<li>Multi-level fallback mechanisms</li>
<li>Comprehensive logging and diagnostics</li>
<li>Simple CLI interface for common operations</li>
</ul>

<h2>Components</h2>

<h3>1. Enhanced Dependency Setup Script</h3>
<h4>Location:</h4> <code>scripts/setup_dependencies.py</code>

<p>Comprehensive Python-based dependency manager with:</p>
<ul>
<li>Virtual environment validation and corruption detection</li>
<li>Automatic repair mechanisms</li>
<li>Dependency verification (actual import testing)</li>
<li>Dependency caching for performance</li>
<li>Detailed verbose logging</li>
</ul>

<h4>Usage:</h4>
<pre><code># Normal setup (auto-detects and fixes issues)
python3 scripts/setup_dependencies.py

# Force complete rebuild
python3 scripts/setup_dependencies.py --force-rebuild

# Validation only (no changes)
python3 scripts/setup_dependencies.py --check-only

# Verbose logging
python3 scripts/setup_dependencies.py --verbose
</code></pre>

<h3>2. Quick Fix Script</h3>
<h4>Location:</h4> <code>scripts/fix_dependencies.sh</code>

<p>User-friendly bash wrapper with simple interface:</p>

<pre><code># Quick fix (most common case)
./scripts/fix_dependencies.sh

# Force complete rebuild
./scripts/fix_dependencies.sh --force

# Check dependencies only
./scripts/fix_dependencies.sh --check
</code></pre>

<h3>3. Enhanced Wrapper</h3>
<h4>Location:</h4> <code>run_capcat.py</code> (refactored)

<p>Integrated into the main Capcat wrapper with:</p>
<ul>
<li>Automatic dependency validation before each run</li>
<li>Intelligent repair attempts on validation failure</li>
<li>Custom exception hierarchy for better error handling</li>
<li>Fallback to system Python when venv unavailable</li>
</ul>

<h2>Common Issues and Solutions</h2>

<h3>Issue: Hardcoded Path Corruption</h3>

<h4>Symptoms:</h4>
<pre><code>venv/bin/pip: line 2: /Users/xpro/...: No such file or directory
</code></pre>

<h4>Cause:</h4>
<p>Virtual environment contains absolute paths from previous location.</p>

<h4>Solution:</h4>
<pre><code>./scripts/fix_dependencies.sh --force
</code></pre>

<h3>Issue: Missing Dependencies</h3>

<h4>Symptoms:</h4>
<pre><code>Missing dependencies: [&#x27;requests&#x27;, &#x27;beautifulsoup4&#x27;, ...]
</code></pre>

<h4>Solution:</h4>
<pre><code>./scripts/fix_dependencies.sh
</code></pre>

<h3>Issue: Broken Virtual Environment</h3>

<h4>Symptoms:</h4>
<ul>
<li>Python executable doesn&#x27;t work</li>
<li>Missing essential venv files</li>
<li>Import errors for installed packages</li>
</ul>

<h4>Solution:</h4>
<pre><code>python3 scripts/setup_dependencies.py --force-rebuild
</code></pre>

<h2>Manual Dependency Setup</h2>

<p>If automated tools fail, manual setup:</p>

<pre><code># 1. Remove broken venv
rm -rf venv

# 2. Create fresh venv
python3 -m venv venv

# 3. Activate venv
source venv/bin/activate

# 4. Install dependencies
pip install -r requirements.txt

# 5. Verify installation
python3 scripts/setup_dependencies.py --check-only
</code></pre>

<h2>Integration with Capcat Wrapper</h2>

<p>The enhanced wrapper (<code>run_capcat.py</code>) automatically:</p>

<ol>
<li><h4>Pre-execution validation</h4> Checks dependencies before running capcat.py</li>
<li><h4>Automatic repair</h4> Attempts to fix issues when detected</li>
<li><h4>Fallback mechanisms</h4> Uses system Python if venv unavailable</li>
<li><h4>Clear error messages</h4> Provides actionable instructions on failure</li>
</ol>

<p>No user intervention required for normal operation.</p>

<h2>Exit Codes</h2>

<p>The dependency system uses specific exit codes:</p>

<ul>
<li><code>0</code>: Success</li>
<li><code>1</code>: General error</li>
<li><code>2</code>: Dependency error (automatic repair failed)</li>
<li><code>3</code>: Execution error</li>
<li><code>130</code>: User interrupted (Ctrl+C)</li>
</ul>

<h2>Validation Process</h2>

<p>The system validates dependencies by:</p>

<ol>
<li><h4>File structure check</h4> Verifies essential venv files exist</li>
<li><h4>Executable test</h4> Runs <code>python --version</code> from venv</li>
<li><h4>Import testing</h4> Attempts to import each required package</li>
<li><h4>Path verification</h4> Checks pyvenv.cfg for valid Python home path</li>
</ol>

<h2>Performance Optimizations</h2>

<ul>
<li><h4>Dependency caching</h4> Avoids redundant package checks</li>
<li><h4>Lazy validation</h4> Only validates when needed</li>
<li><h4>Parallel operations</h4> Future enhancement for faster setup</li>
</ul>

<h2>Troubleshooting</h2>

<h3>Verbose Mode</h3>

<p>Enable detailed logging for diagnostics:</p>

<pre><code>python3 scripts/setup_dependencies.py --verbose --force-rebuild
</code></pre>

<h3>Check-Only Mode</h3>

<p>Validate without making changes:</p>

<pre><code>./scripts/fix_dependencies.sh --check
</code></pre>

<h3>Manual Inspection</h3>

<p>Check virtual environment health:</p>

<pre><code># Check venv structure
ls -la venv/bin/

# Test venv Python
venv/bin/python --version

# Check installed packages
venv/bin/pip list

# Inspect pyvenv.cfg
cat venv/pyvenv.cfg
</code></pre>

<h2>Best Practices</h2>

<ol>
<li><h4>Use the wrapper</h4> Always run <code>./capcat</code> instead of directly running <code>python capcat.py</code></li>
<li><h4>Regular validation</h4> Periodically run <code>--check-only</code> to detect issues early</li>
<li><h4>Clean rebuilds</h4> Use <code>--force</code> when moving project to new location</li>
<li><h4>Keep dependencies minimal</h4> Only add truly required packages to requirements.txt</li>
</ol>

<h2>Advanced Usage</h2>

<h3>Custom Requirements File</h3>

<pre><code>python3 scripts/setup_dependencies.py --requirements custom-requirements.txt
</code></pre>

<h3>Dependency Cache Location</h3>

<p>Cache stored at: <code>venv/.dependency_cache.json</code></p>

<p>Contains:</p>
<ul>
<li>Timestamp of last validation</li>
<li>Installed package versions</li>
<li>Python executable path</li>
</ul>

<h3>Integration with CI/CD</h3>

<pre><code># CI pipeline example
python3 scripts/setup_dependencies.py --check-only || \
  python3 scripts/setup_dependencies.py --force-rebuild
</code></pre>

<h2>Future Enhancements</h2>

<p>Planned improvements:</p>
<ul>
<li>Offline dependency installation from cache</li>
<li>Parallel package installation</li>
<li>Automatic requirements.txt updates</li>
<li>Version conflict detection</li>
<li>Dependency graph visualization</li>
<li>Integration with package managers (brew, apt)</li>
</ul>

<h2>Support</h2>

<p>If automated dependency management fails:</p>

<ol>
<li>Check this documentation for common issues</li>
<li>Run with <code>--verbose</code> flag for detailed diagnostics</li>
<li>Try manual setup steps</li>
<li>Report persistent issues with full error output</li>
</ol>

<script type="module">
  import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.esm.min.mjs';
    mermaid.initialize({
    startOnLoad: true,
    theme: 'base',
    themeVariables: {
      // Primary colors from design system (Capcat orange palette)
      primaryColor: '#FFD4B7',           // --orange-200
      primaryTextColor: '#201419',       // --ink
      primaryBorderColor: '#F1540E',     // --orange-500 / --accent-primary

      // Line and edge colors
      lineColor: '#58444c',              // --ink-medium

      // Secondary colors
      secondaryColor: '#FFEADB',         // --orange-100
      tertiaryColor: '#f9f8ed',          // --accent-cream-primary

      // Text colors
      textColor: '#201419',              // --ink
      mainBkg: '#FAF8EE',                // --cream

      // Node styling
      nodeBorder: '#F1540E',             // --accent-primary
      clusterBkg: '#faf2e7',             // --accent-cream-light
      clusterBorder: '#D44400',          // --orange-600 / --accent-hover

      // Font
      fontFamily: '-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif',
      fontSize: '16px'
    },
    flowchart: {
      nodeSpacing: 50,
      rankSpacing: 50,
      padding: 15,
      useMaxWidth: true,
      htmlLabels: true,
      curve: 'basis'
    }
  });

  // Add copy buttons to Mermaid diagrams after rendering
  document.addEventListener('DOMContentLoaded', function() {
    const mermaidDivs = document.querySelectorAll('.mermaid');

    mermaidDivs.forEach(function(mermaidDiv) {
      // Get the original Mermaid source code
      const mermaidSource = mermaidDiv.textContent;

      // Create container wrapper
      const container = document.createElement('div');
      container.className = 'mermaid-container';

      // Create copy button
      const copyBtn = document.createElement('button');
      copyBtn.className = 'mermaid-copy-btn';
      copyBtn.textContent = 'Copy Mermaid Code';
      copyBtn.setAttribute('title', 'Copy diagram code for Draw.io, Mermaid Live, etc.');

      copyBtn.addEventListener('click', function() {
        navigator.clipboard.writeText(mermaidSource).then(function() {
          copyBtn.textContent = 'Copied!';
          copyBtn.classList.add('copied');

          setTimeout(function() {
            copyBtn.textContent = 'Copy Mermaid Code';
            copyBtn.classList.remove('copied');
          }, 2000);
        });
      });

      // Wrap the mermaid div in container and add button
      mermaidDiv.parentNode.insertBefore(container, mermaidDiv);
      container.appendChild(mermaidDiv);
      container.appendChild(copyBtn);
    });
  });
</script>
    
    
    <script src="../js/main.js"></script>

            </div>
        </div>
    </div>

    <!-- Footer -->
    <div id="footer-placeholder"></div>

    <!-- Back to Top Button -->
    <button id="backToTopBtn" title="Go to top">
        <svg xmlns="http://www.w3.org/2000/svg" height="24" viewBox="0 0 24 24" width="24">
            <path d="M0 0h24v24H0V0z" fill="none"/>
            <path fill="currentColor" d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6 1.41 1.41z"/>
        </svg>
    </button>

    <script src="../../js/includes-loader.js"></script>
  </body>
