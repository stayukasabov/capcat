<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Feature Documentation: Automated Source Addition</title>
    <link rel="stylesheet" href="../css/design-system.css">
    <link rel="stylesheet" href="../css/main.css">
</head>
<body>
    <!-- Header -->
    {% include header.html %}


    <div class="doc-container">
        <div class="container">
            <div class="doc-content">

<div class="nav-breadcrumb"><a href="index.html">Documentation Home</a></div>
<h1>Feature Documentation: Automated Source Addition</h1>

<p>This document provides an overview of the <code>./capcat add-source</code> command, a feature designed to automate the process of adding new RSS-based news sources to the Capcat system.</p>

<h2>1. Purpose</h2>

<p>The primary goal of this feature is to simplify and accelerate the addition of new content sources. It replaces the manual process of creating YAML configuration files with an interactive command-line tool, reducing errors and lowering the barrier for contribution.</p>

<h2>2. Usage</h2>

<p>The command is invoked with a single URL pointing to a valid RSS or Atom feed.</p>

<h4>Syntax:</h4>
<pre><code>./capcat add-source --url &lt;RSS_FEED_URL&gt;
</code></pre>

<h4>Example:</h4>
<pre><code>./capcat add-source --url https://www.theverge.com/rss/index.xml
</code></pre>

<h2>3. The Interactive Process</h2>

<p>Upon execution, the tool guides the user through a series of prompts to configure the new source:</p>

<ol>
<li><h4>Source ID:</h4> The tool inspects the feed to suggest a unique, alphanumeric ID (e.g., <code>theverge</code>). The user can accept this suggestion or provide their own.</li>
<li><h4>Category Assignment:</h4> The user is presented with a list of existing source categories (e.g., <code>tech</code>, <code>news</code>, <code>science</code>) and can assign the new source to one.</li>
<li><h4>Bundle Integration:</h4> The tool asks if the new source should be added to a pre-existing bundle. If the user agrees, they are shown a list of available bundles (e.g., <code>tech</code>, <code>ai</code>) to choose from.</li>
<li><h4>Automated Test:</h4> Finally, the user is prompted to run an immediate test fetch. This test validates that the newly generated configuration works correctly within the Capcat system.</li>
</ol>

<h2>4. Automated Actions</h2>

<p>Based on the user&#x27;s input, the command performs the following actions automatically:</p>

<em>   <h4>Configuration File Generation:</h4> A new YAML file named <code>&lt;source_id&gt;.yml</code> is created in <code>sources/active/config_driven/configs/</code>. This file contains all the necessary metadata to define the new source, including its name, URL, category, and discovery method (which is set to <code>rss</code>).

</em>   <h4>Bundle Modification:</h4> If a bundle was selected, the <code>sources/active/bundles.yml</code> file is safely updated to include the new <code>source_id</code> under the chosen bundle, preserving all existing comments and formatting.

<em>   <h4>Validation:</h4> The command executes the equivalent of <code>./capcat fetch &lt;source_id&gt; --count 1</code> to ensure the source is immediately functional. The success or failure of this test is reported directly to the user.

<h2>5. Core Components</h2>

<p>This functionality is powered by a set of new, single-responsibility services:</p>

</em>   <code>core.source_system.RssFeedIntrospector</code>: A service responsible for fetching the provided URL, validating that it is a legitimate RSS/Atom feed, and extracting initial metadata like the feed&#x27;s title and base URL.

<em>   <code>core.source_system.SourceConfigGenerator</code>: A service that takes the metadata gathered from the introspector and the user prompts to generate the content of the new source&#x27;s YAML configuration file.

</em>   <code>core.source_system.BundleManager</code>: A service that safely handles reading and writing to the <code>bundles.yml</code> file. It uses the <code>ruamel.yaml</code> library to ensure that comments, spacing, and the original structure of the file are preserved during modification.


<script type="module">
  import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.esm.min.mjs';
    mermaid.initialize({
    startOnLoad: true,
    theme: 'base',
    themeVariables: {
      // Primary colors from design system (Capcat orange palette)
      primaryColor: '#FFD4B7',           // --orange-200
      primaryTextColor: '#201419',       // --ink
      primaryBorderColor: '#F1540E',     // --orange-500 / --accent-primary

      // Line and edge colors
      lineColor: '#58444c',              // --ink-medium

      // Secondary colors
      secondaryColor: '#FFEADB',         // --orange-100
      tertiaryColor: '#f9f8ed',          // --accent-cream-primary

      // Text colors
      textColor: '#201419',              // --ink
      mainBkg: '#FAF8EE',                // --cream

      // Node styling
      nodeBorder: '#F1540E',             // --accent-primary
      clusterBkg: '#faf2e7',             // --accent-cream-light
      clusterBorder: '#D44400',          // --orange-600 / --accent-hover

      // Font
      fontFamily: '-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif',
      fontSize: '16px'
    },
    flowchart: {
      nodeSpacing: 50,
      rankSpacing: 50,
      padding: 15,
      useMaxWidth: true,
      htmlLabels: true,
      curve: 'basis'
    }
  });

  // Add copy buttons to Mermaid diagrams after rendering
  document.addEventListener('DOMContentLoaded', function() {
    const mermaidDivs = document.querySelectorAll('.mermaid');

    mermaidDivs.forEach(function(mermaidDiv) {
      // Get the original Mermaid source code
      const mermaidSource = mermaidDiv.textContent;

      // Create container wrapper
      const container = document.createElement('div');
      container.className = 'mermaid-container';

      // Create copy button
      const copyBtn = document.createElement('button');
      copyBtn.className = 'mermaid-copy-btn';
      copyBtn.textContent = 'Copy Mermaid Code';
      copyBtn.setAttribute('title', 'Copy diagram code for Draw.io, Mermaid Live, etc.');

      copyBtn.addEventListener('click', function() {
        navigator.clipboard.writeText(mermaidSource).then(function() {
          copyBtn.textContent = 'Copied!';
          copyBtn.classList.add('copied');

          setTimeout(function() {
            copyBtn.textContent = 'Copy Mermaid Code';
            copyBtn.classList.remove('copied');
          }, 2000);
        });
      });

      // Wrap the mermaid div in container and add button
      mermaidDiv.parentNode.insertBefore(container, mermaidDiv);
      container.appendChild(mermaidDiv);
      container.appendChild(copyBtn);
    });
  });
</script>
    <script src="../js/main.js"></script>

            
<nav class="chapter-navigation" aria-label="Chapter navigation">
    <div class="next-chapter-content">
        <span class="next-chapter-label">Next Chapter</span>
        <span class="next-chapter-arrow" aria-hidden="true">â†’</span>
        <a href="feature-remove-source.html" class="next-chapter-link" rel="next">Remove Source Feature</a>
    </div>
</nav>
</div>
        </div>
    </div>

    <!-- Footer -->
    {% include footer.html %}

    <!-- Back to Top Button -->
    <button id="backToTopBtn" title="Go to top">
        <svg xmlns="http://www.w3.org/2000/svg" height="24" viewBox="0 0 24 24" width="24">
            <path d="M0 0h24v24H0V0z" fill="none"/>
            <path fill="currentColor" d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6 1.41 1.41z"/>
        </svg>
    </button>  </body>
