<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Interactive Mode Comprehensive Reference</title>
    <link rel="stylesheet" href="../../css/design-system.css">
    <link rel="stylesheet" href="../../css/main.css">
</head>
<body>
    <!-- Header -->
    <div id="header-placeholder"></div>


    <div class="doc-container">
        <div class="container">
            <div class="doc-content">

<div class="nav-breadcrumb"><a href="../index.html">Documentation Home</a> / tutorials</div>
<h1>Interactive Mode Comprehensive Reference</h1>

<p>Complete documentation of EVERY function, menu, option, and workflow in Capcat&#x27;s interactive mode.</p>

<p>Source: Application/core/interactive.py</p>

<h2>System Architecture</h2>

<h3>Technology Stack</h3>

<h4>UI Framework:</h4>
<ul>
<li>questionary (prompt_toolkit based)</li>
<li>ANSI escape codes for terminal control</li>
<li>Context managers for logging suppression</li>
</ul>

<h4>Styling:</h4>
<div class="ascii-art"># Custom orange theme (Application/core/interactive.py:10-17)
custom_style = Style([
    (&#x27;questionmark&#x27;, &#x27;fg:#d75f00 bold&#x27;),  # Orange question mark
    (&#x27;question&#x27;, &#x27;bold&#x27;),                 # Bold question text
    (&#x27;selected&#x27;, &#x27;fg:#d75f00&#x27;),          # Orange for selected option
    (&#x27;pointer&#x27;, &#x27;fg:#d75f00 bold&#x27;),      # Orange pointer (▶)
    (&#x27;answer&#x27;, &#x27;fg:#d75f00&#x27;),            # Orange answer
    (&#x27;instruction&#x27;, &#x27;&#x27;),                  # Instruction text
])
</div>

<h4>Color Code:</h4> <code>#d75f00</code> - Orange (RGB: 215, 95, 0)

<h3>Screen Management</h3>

<h3>position_menu_at_bottom(menu_lines=10)</h3>
<p>Location: Application/core/interactive.py:39</p>

<h4>Purpose:</h4> Position cursor for bottom-aligned menu display with ASCII logo at top.

<h4>Parameters:</h4>
<ul>
<li><code>menu_lines</code> (int) - Number of lines menu will occupy (default: 10)</li>
</ul>

<h4>Behavior:</h4>
<ol>
<li>Get terminal size using <code>shutil.get_terminal_size()</code></li>
<li>Clear screen with ANSI code <code>\033[2J</code></li>
<li>Print ASCII logo (8 lines)</li>
<li>Calculate padding: <code>max(0, terminal_height - menu_lines - logo_lines - 1)</code></li>
<li>Print newlines for padding</li>
<li>Menu appears at bottom</li>
</ol>

<h4>ASCII Logo:</h4>
<div class="ascii-art">       ____
     / ____|                     _
    | |     __ _ _ __   ___ __ _| |_
    | |    / _  |  _ \ / __/ _  | __|
    | |___| (_| | |_) | (_| (_| | |_
     \_____\__,_|  __/ \___\__,_|\__|
                | |
                |_|
</div>
<p>Source location: Application/core/interactive.py:54-64</p>

<h4>Terminal Control Codes:</h4>
<ul>
<li><code>\033[2J</code> - Clear entire screen</li>
<li><code>\033[H</code> - Move cursor to home (0,0)</li>
<li><code>\033[38;5;202m</code> - Orange foreground color</li>
<li><code>\033[0m</code> - Reset formatting</li>
<li><code>\033[F</code> - Move cursor up one line</li>
<li><code>\033[K</code> - Clear line from cursor to end</li>
</ul>

<h4>Fallback:</h4> If terminal size detection fails, uses standard clear: <code>print(&#x27;\033[2J\033[H&#x27;, end=&#x27;&#x27;)</code>

<h3>suppress_logging()</h3>
<p>Location: Application/core/interactive.py:28</p>

<h4>Purpose:</h4> Context manager to temporarily suppress logging during menu display.

<h4>Implementation:</h4>
<pre><code>@contextlib.contextmanager
def suppress_logging():
    logger = logging.getLogger()
    original_level = logger.level
    logger.setLevel(logging.CRITICAL)  # Suppress everything below CRITICAL
    try:
        yield
    finally:
        logger.setLevel(original_level)  # Restore original level
</code></pre>

<h4>Usage:</h4>
<pre><code>with suppress_logging():
    response = questionary.select(...).ask()
</code></pre>

<h4>Purpose:</h4> Prevents log messages from interfering with clean menu display.

<h2>Main Entry Point</h2>

<h3>start_interactive_mode()</h3>
<p>Location: Application/core/interactive.py:78</p>

<h4>Purpose:</h4> Main interactive loop for Capcat UI.

<h4>Execution Flow:</h4>
<ol>
<li>Initialize <code>first_run = True</code> flag</li>
<li>Enter infinite while loop</li>
<li>Position menu at bottom (10 lines)</li>
<li>Suppress logging</li>
<li>Show main menu with questionary</li>
<li>Process user selection</li>
<li>Call handler function</li>
<li>Return to step 2</li>
</ol>

<h4>Main Menu Options:</h4>

<ul>
<li><h4>Catch articles from a bundle of sources</h4> → bundle</li>
<li><h4>Catch articles from a list of sources</h4> → fetch</li>
<li><h4>Catch from a single source</h4> → single_source</li>
<li><h4>Catch a single article by URL</h4> → single_url</li>
<li><h4>Manage Sources (add/remove/configure)</h4> → manage_sources</li>
<li><h4>Exit</h4> → exit</li>
</ul>

<h4>Prompt Text:</h4>
<ul>
<li>First run: &quot;  What would you like me to do?&quot;</li>
<li>Subsequent: &quot;  Select an option:&quot;</li>
</ul>

<h4>Navigation:</h4>
<ul>
<li>Arrow keys: Move selection</li>
<li>Enter: Confirm selection</li>
<li>Ctrl+C: Exit (returns <code>None</code> from <code>.ask()</code>)</li>
</ul>

<h4>Terminal Output:</h4>
<div class="ascii-art">       ____
     / ____|                     _
    | |     __ _ _ __   ___ __ _| |_
    | |    / _  |  _ \ / __/ _  | __|
    | |___| (_| | |_) | (_| (_| | |_
     \_____\__,_|  __/ \___\__,_|\__|
                | |
                |_|

  What would you like me to do?

  &gt; Catch articles from a bundle of sources
    Catch articles from a list of sources
    Catch from a single source
    Catch a single article by URL
    Manage Sources (add/remove/configure)
    Exit

   (Use arrow keys to navigate)
</div>

<h4>Selection Echo Handling:</h4>
<pre><code># Clear questionary&#x27;s selection echo and show custom message
print(&#x27;\033[F\033[K&#x27;, end=&#x27;&#x27;)  # Move up, clear line
print(f&quot;  Selected option: {action_names.get(action, action)}&quot;)
</code></pre>

<h4>Exit Conditions:</h4>
<ul>
<li>User selects &quot;Exit&quot;</li>
<li>User presses Ctrl+C</li>
<li><code>action</code> is <code>None</code></li>
<li><code>action == &#x27;exit&#x27;</code></li>
</ul>

<p>Result: Prints &quot;Exiting interactive mode.&quot; and returns to shell.</p>

<h2>Source Management Submenu</h2>

<h3>_handle_manage_sources_flow()</h3>
<p>Location: Application/core/interactive.py:132</p>

<h4>Purpose:</h4> Display and handle source management submenu operations.

<h4>Menu Options:</h4>

<ul>
<li><h4>Add New Source from RSS Feed</h4> → add_rss</li>
<li><h4>Generate Custom Source Config</h4> → generate_config</li>
<li><h4>Remove Existing Sources</h4> → remove</li>
<li><h4>List All Sources</h4> → list_sources</li>
<li><h4>Test a Source</h4> → test_source</li>
<li><h4>Manage Bundles</h4> → manage_bundles</li>
<li><h4>(separator line)</h4> → N/A</li>
<li><h4>Back to Main Menu</h4> → back</li>
</ul>

<h4>Loop Structure:</h4>
<pre><code>while True:
    # Show menu with suppress_logging()
    action = questionary.select(...).ask()

    if not action or action == &#x27;back&#x27;:
        return  # Exit to main menu

    # Call handler based on action
    if action == &#x27;add_rss&#x27;:
        _handle_add_source_from_rss()
    # ... etc
</code></pre>

<h4>Navigation:</h4> Same as main menu (arrow keys, Enter, Ctrl+C)

<h3>_handle_add_source_from_rss()</h3>
<p>Location: Application/core/interactive.py:171</p>

<h4>Purpose:</h4> Interactively add new RSS-based source.

<h4>Workflow:</h4>

<h4>Step 1: URL Input</h4>
<pre><code>print(&quot;  (Use Ctrl+C to go back)&quot;)
url = questionary.text(
    &quot;  Enter the RSS feed URL:&quot;,
    style=custom_style,
    qmark=&quot;&quot;,
).ask()
</code></pre>

<h4>Validation:</h4>
<ul>
<li>If <code>url is None</code> or empty: Print &quot;No URL provided. Returning to menu.&quot; and return</li>
<li>Otherwise: Proceed to step 2</li>
</ul>

<h4>Step 2: RSS Introspection</h4>
<pre><code>from cli import add_source, get_available_sources
add_source(url)  # Calls Application/cli.py:200
</code></pre>

<h4>add_source() performs:</h4>
<ol>
<li>RSS feed inspection with <code>RssFeedIntrospector(url)</code></li>
<li>Source ID suggestion from feed title</li>
<li>Category selection</li>
<li>Config generation</li>
<li>Optional bundle assignment</li>
<li>Optional test fetch</li>
</ol>

<h4>Step 3: Confirmation</h4>
<pre><code>sources = get_available_sources()
print(f&quot;\n[OK] Active sources: {len(sources)}&quot;)
input(&quot;\nPress Enter to continue...&quot;)
</code></pre>

<h4>Error Handling:</h4>
<pre><code>except Exception as e:
    print(f&quot;Error adding source: {e}&quot;)
input(&quot;\nPress Enter to continue...&quot;)
</code></pre>

<h4>Complete Terminal Flow:</h4>
<pre><code>  (Use Ctrl+C to go back)
  Enter the RSS feed URL: https://techcrunch.com/feed/

Attempting to add new source from: https://techcrunch.com/feed/
Inspecting RSS feed...
[OK] Feed &#x27;TechCrunch&#x27; found.

--- Configure New Source ---
  Source ID (alphanumeric): techcrunch
  Select category: tech
  Add to bundle? Yes
  Select bundle: tech
[OK] Added &#x27;techcrunch&#x27; to bundle &#x27;tech&#x27;.

--- Running Test Fetch ---
  Test fetch? (recommended) Yes
[OK] Source added and verified successfully!

[OK] Active sources: 16

Press Enter to continue...
</code></pre>

<h3>_handle_generate_config()</h3>
<p>Location: Application/core/interactive.py:200</p>

<h4>Purpose:</h4> Launch interactive config generator script.

<h4>Workflow:</h4>

<h4>Step 1: Confirmation</h4>
<pre><code>print(&quot;\n--- Generate Custom Source Configuration ---&quot;)
print(&quot;This will launch the interactive config generator.\n&quot;)

confirm = questionary.confirm(
    &quot;  Continue?&quot;,
    default=True,
    style=custom_style,
    qmark=&quot;&quot;,
).ask()
</code></pre>

<h4>Step 2: Script Launch</h4>
<pre><code>import subprocess
script_path = os.path.join(
    os.path.dirname(os.path.dirname(__file__)),
    &quot;scripts&quot;,
    &quot;generate_source_config.py&quot;
)

result = subprocess.run([sys.executable, script_path], check=False)
</code></pre>

<h4>Script Path:</h4> Application/scripts/generate_source_config.py

<h4>Step 3: Result Handling</h4>
<pre><code>if result.returncode != 0:
    print(f&quot;\nConfig generation exited with code: {result.returncode}&quot;)

input(&quot;\nPress Enter to continue...&quot;)
</code></pre>

<h4>Error Handling:</h4>
<pre><code>except Exception as e:
    print(f&quot;Error launching config generator: {e}&quot;)
    input(&quot;\nPress Enter to continue...&quot;)
</code></pre>

<h4>Terminal Output:</h4>
<pre><code>--- Generate Custom Source Configuration ---
This will launch the interactive config generator.

  Continue? Yes

[Interactive config generator launches]
[User goes through wizard...]
[Config saved to sources/active/config_driven/configs/newsource.yaml]

Press Enter to continue...
</code></pre>

<h3>_handle_remove_source()</h3>
<p>Location: Application/core/interactive.py:237</p>

<h4>Purpose:</h4> Launch interactive source removal tool with enhanced features.

<h4>Workflow:</h4>

<h4>Step 1: Service Initialization</h4>
<pre><code>from core.source_system.remove_source_service import create_remove_source_service
from core.source_system.enhanced_remove_command import RemovalOptions

service = create_remove_source_service()
command = service._create_remove_source_command()
</code></pre>

<h4>Step 2: Options Configuration</h4>
<pre><code>options = RemovalOptions(
    dry_run=False,           # No preview mode in interactive
    create_backup=True,      # Always create backup
    show_analytics=True,     # Show usage statistics
    batch_file=None,         # No batch file in interactive
    force=False              # Always confirm
)
</code></pre>

<h4>Step 3: Enhanced Command Execution</h4>
<pre><code>from core.source_system.removal_ui import QuestionaryRemovalUI
from core.source_system.enhanced_remove_command import EnhancedRemoveCommand
from core.source_system.source_backup_manager import SourceBackupManager
from core.source_system.source_analytics import SourceAnalytics

enhanced_command = EnhancedRemoveCommand(
    base_command=command,
    backup_manager=SourceBackupManager(),
    analytics=SourceAnalytics(),
    ui=QuestionaryRemovalUI(),
    logger=get_logger(__name__)
)

enhanced_command.execute_with_options(options)
</code></pre>

<h4>Step 4: Confirmation</h4>
<pre><code>from cli import get_available_sources
sources = get_available_sources()
print(f&quot;\n[OK] Active sources: {len(sources)}&quot;)
input(&quot;\nPress Enter to continue...&quot;)
</code></pre>

<h4>Interactive Removal Flow:</h4>
<ol>
<li>Display all sources with checkbox selection</li>
<li>Show usage analytics for each source</li>
<li>User selects sources with spacebar</li>
<li>Confirm removal</li>
<li>Create automatic backup</li>
<li>Remove sources</li>
<li>Display results</li>
</ol>

<h4>Terminal Output:</h4>
<pre><code>--- Remove Sources ---
This will launch the interactive source removal tool.

Select sources to remove (Space to select, Enter to confirm):
  [ ] hn              Hacker News
  [x] oldsite         Old Site
  [x] discontinued    Discontinued Source
  [ ] bbc             BBC News

Usage Analytics:
  oldsite: Last used 90 days ago, 5 articles
  discontinued: Last used 180 days ago, 0 articles

Confirm removal? Yes

[OK] Backup created: .capcat-backups/backup_20251125_143022/
[OK] Removed 2 sources successfully

[OK] Active sources: 14

Press Enter to continue...
</code></pre>

<h3>_handle_list_sources()</h3>
<p>Location: Application/core/interactive.py:287</p>

<h4>Purpose:</h4> Display all sources grouped by category with interactive details view.

<h4>Workflow:</h4>

<h4>Step 1: Source Collection</h4>
<pre><code>from cli import get_available_sources
from core.source_system.source_registry import get_source_registry

sources = get_available_sources()  # Dict[source_id, display_name]
registry = get_source_registry()
</code></pre>

<h4>Step 2: Category Grouping</h4>
<pre><code>categories = {}  # Dict[category, List[Tuple[source_id, display_name]]]

for source_id, display_name in sorted(sources.items()):
    try:
        config = registry.get_source_config(source_id)
        category = config.category if config and hasattr(config, &#x27;category&#x27;) else &#x27;other&#x27;
    except:
        category = &#x27;other&#x27;

    if category not in categories:
        categories[category] = []

    categories[category].append((source_id, display_name))
</code></pre>

<h4>Step 3: Menu Construction</h4>
<div class="ascii-art">choices = []

# Header
choices.append(questionary.Separator(f&quot;\n  Available Sources ({len(sources)} total)&quot;))
choices.append(questionary.Separator())

# Grouped sources
for category, source_list in sorted(categories.items()):
    # Category header
    choices.append(questionary.Separator(f&quot;  {category.upper()}&quot;))

    # Sources in category
    for source_id, display_name in source_list:
        formatted_name = f&quot;  {source_id:15} → {display_name}&quot;
        choices.append(questionary.Choice(formatted_name, source_id))

    # Blank line
    choices.append(questionary.Separator())

# Footer
choices.append(questionary.Separator(&quot;─&quot; * 50))
choices.append(questionary.Choice(&quot;Back to Source Management&quot;, &quot;back&quot;))
</div>

<h4>Step 4: Interactive Selection</h4>
<div class="ascii-art">selected = questionary.select(
    &quot;  Browse sources (select to view details):&quot;,
    choices=choices,
    style=custom_style,
    qmark=&quot;&quot;,
    pointer=&quot;▶&quot;,
    instruction=&quot;\n   (Use arrow keys, Enter to view details)&quot;,
).ask()
</div>

<h4>Step 5: Detail View (if source selected)</h4>
<pre><code>if selected and selected != &#x27;back&#x27;:
    _show_source_details(selected, registry)
    _handle_list_sources()  # Recursive call to return to listing
</code></pre>

<h4>Terminal Output:</h4>
<div class="ascii-art">  Available Sources (15 total)

  TECH
    hn              → Hacker News
    lb              → Lobsters
    iq              → InfoQ

  NEWS
    bbc             → BBC News
    guardian        → The Guardian

  SCIENCE
    nature          → Nature News

─────────────────────────────────────────────────
  Back to Source Management

  Browse sources (select to view details):

   (Use arrow keys, Enter to view details)
</div>

<h3>_show_source_details(source_id, registry)</h3>
<p>Location: Application/core/interactive.py:351</p>

<h4>Purpose:</h4> Display detailed information about a selected source.

<h4>Parameters:</h4>
<ul>
<li><code>source_id</code> (str) - Source identifier</li>
<li><code>registry</code> (SourceRegistry) - Registry instance</li>
</ul>

<h4>Display Format:</h4>
<div class="ascii-art">print(&quot;\n&quot; + &quot;─&quot; * 70)
print(f&quot;\033[38;5;202m  Source Details\033[0m&quot;)  # Orange heading
print(&quot;─&quot; * 70)
</div>

<h4>Information Displayed:</h4>

<ol>
<li><h4>Core Information:</h4></li>
<ul>
<li>ID</li>
</ol>
<ul>
<li>Name (display_name)</li>
<li>Category</li>
</ul>

<ol>
<li><h4>Base URL:</h4></li>
</ol>
   <pre><code>   if hasattr(config, &#x27;base_url&#x27;):
       print(f&quot;  \033[1mBase URL:\033[0m     {config.base_url}&quot;)
   </code></pre>

<ol>
<li><h4>Discovery Method:</h4></li>
</ol>
   <pre><code>   if hasattr(config, &#x27;discovery&#x27;) and hasattr(config.discovery, &#x27;method&#x27;):
       print(f&quot;  \033[1mDiscovery:\033[0m    {config.discovery.method}&quot;)

       # RSS URLs if available
       if config.discovery.method == &#x27;rss&#x27; and hasattr(config.discovery, &#x27;rss_urls&#x27;):
           if hasattr(rss_urls, &#x27;primary&#x27;):
               print(f&quot;  \033[1mRSS Feed:\033[0m     {rss_urls.primary}&quot;)
   </code></pre>

<ol>
<li><h4>Source Type:</h4></li>
</ol>
   <pre><code>   source_type = &quot;Config-driven (YAML)&quot; if hasattr(config, &#x27;article_selectors&#x27;) else &quot;Custom (Python)&quot;
   print(f&quot;  \033[1mType:\033[0m         {source_type}&quot;)
   </code></pre>

<h4>Terminal Output:</h4>
<div class="ascii-art">──────────────────────────────────────────────────────────────────────
  Source Details
──────────────────────────────────────────────────────────────────────

  ID:           hn
  Name:         Hacker News
  Category:     tech
  Base URL:     https://news.ycombinator.com/
  Discovery:    api
  Type:         Custom (Python)

──────────────────────────────────────────────────────────────────────

  Press Enter to continue...
</div>

<h4>Error Handling:</h4>
<pre><code>except Exception as e:
    print(f&quot;\n  Error loading source details: {e}&quot;)
input(&quot;\n  Press Enter to continue...&quot;)
</code></pre>

<h3>_handle_test_source()</h3>
<p>Location: Application/core/interactive.py:396</p>

<h4>Purpose:</h4> Test a source by fetching 3 sample articles.

<h4>Workflow:</h4>

<h4>Step 1: Source Selection</h4>
<div class="ascii-art">from cli import get_available_sources

sources = get_available_sources()
source_choices = [questionary.Choice(name, sid) for sid, name in sources.items()]
source_choices.append(questionary.Separator())
source_choices.append(questionary.Choice(&quot;Back&quot;, &quot;back&quot;))

source_id = questionary.select(
    &quot;  Select source to test:&quot;,
    choices=source_choices,
    style=custom_style,
    qmark=&quot;&quot;,
    pointer=&quot;▶&quot;,
    instruction=&quot;\n   (Use arrow keys to navigate)&quot;,
).ask()
</div>

<h4>Step 2: Test Execution</h4>
<pre><code>print(f&quot;\n--- Testing Source: {source_id} ---&quot;)
print(&quot;Fetching 3 articles...\n&quot;)

from capcat import run_app
args = [&#x27;fetch&#x27;, source_id, &#x27;--count&#x27;, &#x27;3&#x27;]
run_app(args)
</code></pre>

<h4>Step 3: Result Display</h4>
<pre><code>print(f&quot;\n[OK] Source &#x27;{source_id}&#x27; test completed&quot;)
</code></pre>

<h4>Error Handling:</h4>
<pre><code>except SystemExit as e:
    if e.code != 0:
        print(f&quot;\n✗ Source test failed with code: {e.code}&quot;)
except Exception as e:
    print(f&quot;\n✗ Error testing source: {e}&quot;)

input(&quot;\nPress Enter to continue...&quot;)
</code></pre>

<h4>Terminal Output:</h4>
<pre><code>  Select source to test:
  &gt; Hacker News
    Lobsters
    BBC News
    Back

--- Testing Source: hn ---
Fetching 3 articles...

Processing hn articles...
[Article processing output...]
Successfully processed 3 articles

[OK] Source &#x27;hn&#x27; test completed

Press Enter to continue...
</code></pre>

<h2>Main Menu Handlers</h2>

<h3>_handle_bundle_flow()</h3>
<p>Location: Application/core/interactive.py:436</p>

<h4>Purpose:</h4> Handle bundle selection and execution.

<h4>Workflow:</h4>

<h4>Step 1: Menu Positioning</h4>
<pre><code># Bundle menu can be long
position_menu_at_bottom(menu_lines=15)
</code></pre>

<h4>Step 2: Bundle Discovery</h4>
<pre><code>from cli import get_available_bundles, get_available_sources
from core.source_system.source_registry import get_source_registry

bundles = get_available_bundles()
all_sources_map = get_available_sources()
registry = get_source_registry()
</code></pre>

<h4>Step 3: Bundle Choices Construction</h4>
<pre><code>bundle_choices = []

for name, data in bundles.items():
    description = data.get(&quot;description&quot;, &quot;&quot;)

    # Special handling for &#x27;all&#x27; bundle
    if name == &quot;all&quot;:
        full_description = description
    else:
        # Explicit sources from bundles.yml
        bundle_sources = data.get(&quot;sources&quot;, [])

        # Auto-discover sources with matching category
        category_sources = registry.get_sources_by_category(name)
        for source_id in category_sources:
            if source_id not in bundle_sources:
                bundle_sources.append(source_id)

        # Format with source names
        source_names = [all_sources_map.get(sid, sid) for sid in bundle_sources]
        sources_str = f&quot;\n   ({&#x27;, &#x27;.join(source_names)})&quot; if source_names else &quot;&quot;
        full_description = f&quot;{description}{sources_str}&quot;

    bundle_choices.append(questionary.Choice(f&quot;{name} - {full_description}&quot;, name))
</code></pre>

<h4>Step 4: Interactive Selection</h4>
<div class="ascii-art">bundle = questionary.select(
    &quot;  Select a news bundle and hit Enter for activation.&quot;,
    choices=bundle_choices,
    style=custom_style,
    qmark=&quot;&quot;,
    pointer=&quot;▶&quot;,
    instruction=&quot;\n   (Use arrow keys to navigate)&quot;,
).ask()
</div>

<h4>Step 5: HTML Prompt</h4>
<pre><code>if bundle and bundle != &#x27;back&#x27;:
    _prompt_for_html(&#x27;bundle&#x27;, bundle)
</code></pre>

<h4>Terminal Output:</h4>
<pre><code>  Select a news bundle and hit Enter for activation.

  &gt; tech - Technology News
   (IEEE Spectrum, Mashable, Gizmodo)

    techpro - Advanced Technology
   (Hacker News, Lobsters, InfoQ)

    news - General News
   (BBC News, The Guardian)

    science - Science News
   (Nature News, Scientific American)

    all - All available sources

    Back to Main Menu

   (Use arrow keys to navigate)
</code></pre>

<h3>_handle_fetch_flow()</h3>
<p>Location: Application/core/interactive.py:492</p>

<h4>Purpose:</h4> Handle multi-source selection and execution.

<h4>Workflow:</h4>

<h4>Step 1: Menu Positioning</h4>
<pre><code>position_menu_at_bottom(menu_lines=15)
</code></pre>

<h4>Step 2: Source Choices</h4>
<pre><code>from cli import get_available_sources
sources = get_available_sources()

source_choices = [questionary.Choice(name, sid) for sid, name in sources.items()]
source_choices.append(questionary.Separator())
source_choices.append(questionary.Choice(&quot;Back to Main Menu&quot;, &quot;back&quot;))
</code></pre>

<h4>Step 3: Checkbox Selection</h4>
<div class="ascii-art">selected_sources = questionary.checkbox(
    &quot;  Select sources (Space to select, Enter to confirm):&quot;,
    choices=source_choices,
    style=custom_style,
    qmark=&quot;&quot;,
    pointer=&quot;▶&quot;,
    instruction=&quot;\n   (Use Space to select multiple sources, Enter to confirm)&quot;,
).ask()
</div>

<h4>Checkbox Navigation:</h4>
<ul>
<li>Arrow keys: Move between sources</li>
<li>Space: Toggle selection (checkbox)</li>
<li>Enter: Confirm all selected</li>
<li>Ctrl+C: Cancel</li>
</ul>

<h4>Step 4: HTML Prompt</h4>
<pre><code>if selected_sources and &#x27;back&#x27; not in selected_sources:
    _prompt_for_html(&#x27;fetch&#x27;, selected_sources)
</code></pre>

<h4>Terminal Output:</h4>
<pre><code>  Select sources (Space to select, Enter to confirm):

  [ ] hn              Hacker News
  [x] lb              Lobsters
  [x] iq              InfoQ
  [ ] bbc             BBC News
  [ ] guardian        The Guardian

  Back to Main Menu

   (Use Space to select multiple sources, Enter to confirm)
</code></pre>

<h3>_handle_single_source_flow()</h3>
<p>Location: Application/core/interactive.py:520</p>

<h4>Purpose:</h4> Handle single source selection and execution.

<h4>Workflow:</h4>

<h4>Step 1: Menu Positioning</h4>
<pre><code>position_menu_at_bottom(menu_lines=15)
</code></pre>

<h4>Step 2: Source Selection</h4>
<div class="ascii-art">from cli import get_available_sources
sources = get_available_sources()

source_choices = [questionary.Choice(name, sid) for sid, name in sources.items()]
source_choices.append(questionary.Separator())
source_choices.append(questionary.Choice(&quot;Back to Main Menu&quot;, &quot;back&quot;))

source = questionary.select(
    &quot;  Select a source and hit Enter for activation.&quot;,
    choices=source_choices,
    style=custom_style,
    qmark=&quot;&quot;,
    pointer=&quot;▶&quot;,
    instruction=&quot;\n   (Use arrow keys to navigate)&quot;,
).ask()
</div>

<h4>Step 3: HTML Prompt</h4>
<pre><code>if source and source != &#x27;back&#x27;:
    # For single source, call fetch with just one source
    _prompt_for_html(&#x27;fetch&#x27;, [source])
</code></pre>

<h4>Note:</h4> Internally uses <code>fetch</code> action with single-item list, not separate <code>single_source</code> action.

<h3>_handle_single_url_flow()</h3>
<p>Location: Application/core/interactive.py:549</p>

<h4>Purpose:</h4> Handle single article URL input and execution.

<h4>Workflow:</h4>

<h4>Step 1: Menu Positioning</h4>
<pre><code>position_menu_at_bottom(menu_lines=5)
</code></pre>

<h4>Step 2: URL Input</h4>
<pre><code>print(&quot;  (Use Ctrl+C to go to the Main Menu)&quot;)

url = questionary.text(
    &quot;  Please enter the article URL:&quot;,
    style=custom_style,
    qmark=&quot;&quot;,
).ask()
</code></pre>

<h4>Step 3: Validation</h4>
<pre><code>if url:
    _prompt_for_html(&#x27;single&#x27;, url)
else:
    repeat = questionary.confirm(
        &quot;  No URL entered. Would you like to try again?&quot;,
        default=True,
        style=custom_style,
        qmark=&quot;&quot;,
    ).ask()

    if repeat:
        _handle_single_url_flow()  # Recursive call
</code></pre>

<h4>Terminal Output:</h4>
<pre><code>  (Use Ctrl+C to go to the Main Menu)
  Please enter the article URL: https://example.com/article

[Proceeds to HTML prompt]
</code></pre>

<h4>Empty Input Handling:</h4>
<pre><code>  Please enter the article URL: [Enter pressed]

  No URL entered. Would you like to try again? Yes

  Please enter the article URL:
</code></pre>

<h2>Shared Functions</h2>

<h3>_prompt_for_html(action, selection)</h3>
<p>Location: Application/core/interactive.py:578</p>

<h4>Purpose:</h4> Prompt user for HTML generation preference.

<h4>Parameters:</h4>
<ul>
<li><code>action</code> (str) - Action type: &#x27;bundle&#x27;, &#x27;fetch&#x27;, or &#x27;single&#x27;</li>
<li><code>selection</code> - Bundle name, source list, or URL depending on action</li>
</ul>

<h4>Workflow:</h4>

<h4>Step 1: Menu Positioning</h4>
<pre><code>position_menu_at_bottom(menu_lines=8)
</code></pre>

<h4>Step 2: HTML Prompt</h4>
<div class="ascii-art">response = questionary.select(
    &quot;  Generate HTML for web browsing?&quot;,
    choices=[
        questionary.Choice(&quot;Yes&quot;, &quot;yes&quot;),
        questionary.Choice(&quot;No&quot;, &quot;no&quot;),
        questionary.Separator(),
        questionary.Choice(&quot;Back to Main Menu&quot;, &quot;back&quot;),
    ],
    style=custom_style,
    qmark=&quot;&quot;,
    pointer=&quot;▶&quot;,
    instruction=&quot;\n   (Use arrow keys to navigate)&quot;,
).ask()
</div>

<h4>Step 3: Execution</h4>
<pre><code>if response and response != &#x27;back&#x27;:
    generate_html = response == &quot;yes&quot;
    _confirm_and_execute(action, selection, generate_html)
</code></pre>

<h4>Terminal Output:</h4>
<pre><code>  Generate HTML for web browsing?

  &gt; Yes
    No

    Back to Main Menu

   (Use arrow keys to navigate)
</code></pre>

<h3>_confirm_and_execute(action, selection, generate_html)</h3>
<p>Location: Application/core/interactive.py:604</p>

<h4>Purpose:</h4> Display summary and execute command via run_app().

<h4>Parameters:</h4>
<ul>
<li><code>action</code> (str) - Action type: &#x27;bundle&#x27;, &#x27;fetch&#x27;, or &#x27;single&#x27;</li>
<li><code>selection</code> - Action-specific data</li>
<li><code>generate_html</code> (bool) - HTML generation flag</li>
</ul>

<h4>Workflow:</h4>

<h4>Step 1: Summary Construction</h4>
<pre><code>summary = f&quot;Action: {action}\n&quot;

if action == &#x27;bundle&#x27;:
    summary += f&quot;Bundle: {selection}\n&quot;
elif action == &#x27;fetch&#x27;:
    summary += f&quot;Sources: {&#x27;, &#x27;.join(selection)}\n&quot;
elif action == &#x27;single&#x27;:
    summary += f&quot;URL: {selection}\n&quot;

summary += f&quot;Generate HTML: {generate_html}\n&quot;
</code></pre>

<h4>Step 2: Summary Display</h4>
<pre><code>print(&quot;--------------------&quot;)
print(&quot;SUMMARY&quot;)
print(summary)
print(&quot;--------------------&quot;)
</code></pre>

<h4>Step 3: Argument Construction</h4>
<pre><code>args = [action]

if action == &#x27;bundle&#x27;:
    args.append(selection)
elif action == &#x27;fetch&#x27;:
    args.append(&#x27;,&#x27;.join(selection))
elif action == &#x27;single&#x27;:
    args.append(selection)

if generate_html:
    args.append(&#x27;--html&#x27;)
</code></pre>

<h4>Step 4: Execution</h4>
<pre><code>try:
    print(&quot;Executing command...&quot;)
    run_app(args)  # From Application/capcat.py:run_app()
except SystemExit as e:
    if e.code != 0:
        print(f&quot;Command finished with error code: {e.code}&quot;)
        sys.exit(e.code)  # Re-raise error for wrapper
    # On success (code 0), continue without exiting
</code></pre>

<h4>Step 5: Return to Menu</h4>
<pre><code>input(&quot;\nPress Enter to return to main menu...&quot;)
</code></pre>

<h4>Terminal Output:</h4>
<pre><code>--------------------
SUMMARY
Action: bundle
Bundle: tech
Generate HTML: true
--------------------

Executing command...

Processing ieee articles...
Processing mashable articles...
[Article processing output...]

Successfully processed 2 sources

Press Enter to return to main menu...
</code></pre>

<h2>Bundle Management</h2>

<h3>_handle_manage_bundles()</h3>
<p>Location: Application/core/interactive.py:649</p>

<h4>Purpose:</h4> Handle bundle management submenu.

<h4>Workflow:</h4>

<h4>Step 1: Service Initialization</h4>
<pre><code>from pathlib import Path
from core.source_system.bundle_service import BundleService

bundles_path = Path(__file__).parent.parent / &quot;sources&quot; / &quot;active&quot; / &quot;bundles.yml&quot;
service = BundleService(bundles_path)
</code></pre>

<h4>Step 2: Menu Loop</h4>
<pre><code>while True:
    action = service.ui.show_bundle_menu()

    if not action or action == &#x27;back&#x27;:
        return

    # Execute action
    if action == &#x27;create&#x27;:
        service.execute_create_bundle()
    elif action == &#x27;edit&#x27;:
        service.execute_edit_bundle()
    elif action == &#x27;delete&#x27;:
        service.execute_delete_bundle()
    elif action == &#x27;add_sources&#x27;:
        service.execute_add_sources()
    elif action == &#x27;remove_sources&#x27;:
        service.execute_remove_sources()
    elif action == &#x27;move_sources&#x27;:
        service.execute_move_source()
    elif action == &#x27;list&#x27;:
        service.execute_list_bundles()
</code></pre>

<h4>Available Actions:</h4>
<ul>
<li><code>create</code> - Create new bundle</li>
<li><code>edit</code> - Edit bundle name/description</li>
<li><code>delete</code> - Delete bundle</li>
<li><code>add_sources</code> - Add sources to bundle</li>
<li><code>remove_sources</code> - Remove sources from bundle</li>
<li><code>move_sources</code> - Move sources between bundles</li>
<li><code>list</code> - List all bundles</li>
</ul>

<h4>Service Location:</h4> Application/core/source_system/bundle_service.py

<h2>Integration with CLI</h2>

<h3>run_app() Integration</h3>
<p>Location: Application/capcat.py</p>

<h4>How Interactive Mode Calls CLI:</h4>

<pre><code>from capcat import run_app

# Example: Bundle execution
args = [&#x27;bundle&#x27;, &#x27;tech&#x27;, &#x27;--html&#x27;]
run_app(args)
</code></pre>

<h4>Arguments Format:</h4>
<pre><code># Bundle
args = [&#x27;bundle&#x27;, bundle_name, &#x27;--html&#x27;]  # or without --html

# Fetch
args = [&#x27;fetch&#x27;, &#x27;source1,source2,source3&#x27;, &#x27;--html&#x27;]

# Single
args = [&#x27;single&#x27;, url, &#x27;--html&#x27;]
</code></pre>

<h4>Exit Code Handling:</h4>
<pre><code>try:
    run_app(args)
except SystemExit as e:
    if e.code != 0:
        # Handle error
        print(f&quot;Error: {e.code}&quot;)
        sys.exit(e.code)  # Re-raise for wrapper
    # Success: Continue interactive mode
</code></pre>

<h4>Why SystemExit:</h4> <code>run_app()</code> calls <code>sys.exit()</code> on completion, which raises <code>SystemExit</code> exception. Interactive mode catches this to prevent exiting.

<h2>Error Handling</h2>

<h3>Network Errors</h3>
<pre><code>try:
    run_app(args)
except SystemExit as e:
    if e.code != 0:
        print(f&quot;Command finished with error code: {e.code}&quot;)
</code></pre>

<h3>User Cancellation</h3>
<pre><code>if response is None:  # User pressed Ctrl+C
    return  # Go back to previous menu
</code></pre>

<h3>Invalid Input</h3>
<pre><code>if not url:
    print(&quot;  No URL provided. Returning to menu.&quot;)
    return
</code></pre>

<h3>Service Errors</h3>
<pre><code>except Exception as e:
    print(f&quot;Error: {e}&quot;)
    input(&quot;\nPress Enter to continue...&quot;)
</code></pre>

<h2>Keyboard Navigation</h2>

<h3>All Menus</h3>
<ul>
<li><h4>Arrow Up/Down:</h4> Navigate options</li>
<li><h4>Enter:</h4> Confirm selection</li>
<li><h4>Ctrl+C:</h4> Cancel/go back</li>
<li><h4>Escape:</h4> Same as Ctrl+C</li>
</ul>

<h3>Checkbox Menus (Multi-select)</h3>
<ul>
<li><h4>Space:</h4> Toggle selection</li>
<li><h4>Arrow Up/Down:</h4> Navigate</li>
<li><h4>Enter:</h4> Confirm all selected</li>
<li><h4>Ctrl+C:</h4> Cancel</li>
</ul>

<h3>Text Input</h3>
<ul>
<li><h4>Type:</h4> Enter text</li>
<li><h4>Backspace:</h4> Delete character</li>
<li><h4>Ctrl+U:</h4> Clear entire line</li>
<li><h4>Enter:</h4> Confirm input</li>
<li><h4>Ctrl+C:</h4> Cancel input</li>
</ul>

<h2>Session Management</h2>

<h3>State Persistence</h3>
<ul>
<li><h4>No persistent state:</h4> Each operation is independent</li>
<li><h4>No session history:</h4> Previous selections not remembered</li>
<li><h4>Fresh state:</h4> Each menu start is clean</li>
</ul>

<h3>Configuration</h3>
<ul>
<li><h4>Uses global config:</h4> <code>capcat.yml</code> and environment variables</li>
<li><h4>No interactive-specific config:</h4> Same settings as CLI</li>
</ul>

<h2>Source Code Locations</h2>

<p>Function reference:</p>
<ul>
<li><code>start_interactive_mode()</code> - Application/core/interactive.py:78</li>
<li><code>position_menu_at_bottom()</code> - Application/core/interactive.py:39</li>
<li><code>suppress_logging()</code> - Application/core/interactive.py:28</li>
<li><code>_handle_manage_sources_flow()</code> - Application/core/interactive.py:132</li>
<li><code>_handle_bundle_flow()</code> - Application/core/interactive.py:436</li>
<li><code>_handle_fetch_flow()</code> - Application/core/interactive.py:492</li>
<li><code>_handle_single_source_flow()</code> - Application/core/interactive.py:520</li>
<li><code>_handle_single_url_flow()</code> - Application/core/interactive.py:549</li>
<li><code>_prompt_for_html()</code> - Application/core/interactive.py:578</li>
<li><code>_confirm_and_execute()</code> - Application/core/interactive.py:604</li>
<li><code>_show_source_details()</code> - Application/core/interactive.py:351</li>
</ul>

<h2>Related Documentation</h2>

<ul>
<li>CLI Commands: docs/tutorials/01-cli-commands-exhaustive.md</li>
<li>Source System: docs/tutorials/04-source-system-exhaustive.md</li>
<li>Configuration: docs/tutorials/03-configuration-exhaustive.md</li>
</ul>


<script type="module">
  import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.esm.min.mjs';
    mermaid.initialize({
    startOnLoad: true,
    theme: 'base',
    themeVariables: {
      // Primary colors from design system (Capcat orange palette)
      primaryColor: '#FFD4B7',           // --orange-200
      primaryTextColor: '#201419',       // --ink
      primaryBorderColor: '#F1540E',     // --orange-500 / --accent-primary

      // Line and edge colors
      lineColor: '#58444c',              // --ink-medium

      // Secondary colors
      secondaryColor: '#FFEADB',         // --orange-100
      tertiaryColor: '#f9f8ed',          // --accent-cream-primary

      // Text colors
      textColor: '#201419',              // --ink
      mainBkg: '#FAF8EE',                // --cream

      // Node styling
      nodeBorder: '#F1540E',             // --accent-primary
      clusterBkg: '#faf2e7',             // --accent-cream-light
      clusterBorder: '#D44400',          // --orange-600 / --accent-hover

      // Font
      fontFamily: '-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif',
      fontSize: '16px'
    },
    flowchart: {
      nodeSpacing: 50,
      rankSpacing: 50,
      padding: 15,
      useMaxWidth: true,
      htmlLabels: true,
      curve: 'basis'
    }
  });

  // Add copy buttons to Mermaid diagrams after rendering
  document.addEventListener('DOMContentLoaded', function() {
    const mermaidDivs = document.querySelectorAll('.mermaid');

    mermaidDivs.forEach(function(mermaidDiv) {
      // Get the original Mermaid source code
      const mermaidSource = mermaidDiv.textContent;

      // Create container wrapper
      const container = document.createElement('div');
      container.className = 'mermaid-container';

      // Create copy button
      const copyBtn = document.createElement('button');
      copyBtn.className = 'mermaid-copy-btn';
      copyBtn.textContent = 'Copy Mermaid Code';
      copyBtn.setAttribute('title', 'Copy diagram code for Draw.io, Mermaid Live, etc.');

      copyBtn.addEventListener('click', function() {
        navigator.clipboard.writeText(mermaidSource).then(function() {
          copyBtn.textContent = 'Copied!';
          copyBtn.classList.add('copied');

          setTimeout(function() {
            copyBtn.textContent = 'Copy Mermaid Code';
            copyBtn.classList.remove('copied');
          }, 2000);
        });
      });

      // Wrap the mermaid div in container and add button
      mermaidDiv.parentNode.insertBefore(container, mermaidDiv);
      container.appendChild(mermaidDiv);
      container.appendChild(copyBtn);
    });
  });
</script>
    <script src="../../js/main.js"></script>

            
<nav class="chapter-navigation" aria-label="Chapter navigation">
    <div class="next-chapter-content">
        <span class="next-chapter-label">Next Chapter</span>
        <span class="next-chapter-arrow" aria-hidden="true">→</span>
        <a href="03-configuration-exhaustive.html" class="next-chapter-link" rel="next">Tutorial 3: Configuration (Comprehensive)</a>
    </div>
</nav>
</div>
        </div>
    </div>

    <!-- Footer -->
    <div id="footer-placeholder"></div>

    <!-- Back to Top Button -->
    <button id="backToTopBtn" title="Go to top">
        <svg xmlns="http://www.w3.org/2000/svg" height="24" viewBox="0 0 24 24" width="24">
            <path d="M0 0h24v24H0V0z" fill="none"/>
            <path fill="currentColor" d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6 1.41 1.41z"/>
        </svg>
    </button>

    <script src="../../js/includes-loader.js"></script>
  </body>
